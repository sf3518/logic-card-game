{"ast":null,"code":"import _slicedToArray from\"/Users/johnny/IC/Computing/year2/DRP/drp48/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useContext,useState}from\"react\";import Dialog from\"@material-ui/core/Dialog/Dialog\";import DialogTitle from\"@material-ui/core/DialogTitle/DialogTitle\";import DialogContent from\"@material-ui/core/DialogContent/DialogContent\";import TextField from\"@material-ui/core/TextField/TextField\";import MButton from\"@material-ui/core/Button\";import DialogActions from\"@material-ui/core/DialogActions/DialogActions\";import Grid from\"@material-ui/core/Grid/Grid\";import{userService}from\"../../services/user.service\";import{LoginContext}from\"../../LoginContext\";import{Divider,LinearProgress}from\"@material-ui/core\";export var RegisterDialogue=function RegisterDialogue(_ref){var open=_ref.open,onClose=_ref.onClose,onSwitchToLogin=_ref.onSwitchToLogin;var logins=useContext(LoginContext);var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isUsernameValid=_useState2[0],setUsernameValid=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),username=_useState4[0],setUsername=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isEmailValid=_useState6[0],setEmailValid=_useState6[1];var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),email=_useState8[0],setEmail=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),isPasswordValid=_useState10[0],setPasswordValid=_useState10[1];var _useState11=useState(\"\"),_useState12=_slicedToArray(_useState11,2),password=_useState12[0],setPassword=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),isLoading=_useState14[0],setLoading=_useState14[1];var _useState15=useState(true),_useState16=_slicedToArray(_useState15,2),isFirstTime=_useState16[0],setFirstTime=_useState16[1];var checkEmail=function checkEmail(){var re=/^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;var ok=re.test(String(email).toLowerCase());setEmailValid(ok);return ok;};var checkUsername=function checkUsername(){var ok=username.length>=2&&username.length<=50&&!username.includes(\";\");setUsernameValid(ok);return ok;};var checkPassword=function checkPassword(){var ok=password.length>=4;setPasswordValid(ok);return ok;};var submit=function submit(){if(checkEmail()&&checkUsername()&&checkPassword()){setLoading(true);userService.register(username,email,password,logins.toggleSetUser).then(function(res){if(res){userService.login(username,password,logins.toggleSetUser,function(){return alert(\"login error\");}).then(function(resp){setLoading(false);if(resp){onClose();}});}else{alert(\"Register error\");setLoading(false);}});}};return/*#__PURE__*/React.createElement(Dialog,{open:open,onClose:onClose,\"aria-labelledby\":\"form-dialog-title\",PaperProps:{style:{backgroundColor:\"rgba(255, 255, 255, .70)\",boxShadow:\"inset 0 0 1rem 0 rgba(0, 0, 0, .2)\",borderRadius:\"5px\",backdropFilter:\"blur(7px)\"}}},/*#__PURE__*/React.createElement(DialogTitle,{id:\"form-dialog-title\"},\"Sign Up\"),/*#__PURE__*/React.createElement(DialogContent,null,/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(TextField,{required:true,id:\"standard-required\",label:\"Username\",onChange:function onChange(event){return setUsername(event.target.value);},error:!isUsernameValid&&!isFirstTime,helperText:isUsernameValid||isFirstTime?\"\":\"Username must contain 2 ~ 50 valid characters\"})),/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(TextField,{required:true,id:\"standard-required\",label:\"Email\",onChange:function onChange(event){return setEmail(event.target.value);},error:!isEmailValid&&!isFirstTime,helperText:isEmailValid||isFirstTime?\"\":\"Must be a valid email address\"})),/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(TextField,{required:true,id:\"standard-password-input\",label:\"Password\",type:\"password\",autoComplete:\"current-password\",onChange:function onChange(event){return setPassword(event.target.value);},error:!isPasswordValid&&!isFirstTime,helperText:isPasswordValid||isFirstTime?\"\":\"Password must contain more than 4 characters\"})),/*#__PURE__*/React.createElement(\"div\",{style:{textAlign:\"right\",marginTop:\"10px\"}},/*#__PURE__*/React.createElement(MButton,{style:{width:\"100%\",backgroundColor:\"green\",color:\"white\"},onClick:submit},\"SUBMIT\"),isLoading?/*#__PURE__*/React.createElement(LinearProgress,null):undefined)),/*#__PURE__*/React.createElement(Divider,null),/*#__PURE__*/React.createElement(DialogActions,null,/*#__PURE__*/React.createElement(Grid,{container:true,style:{justifyItems:\"center\",alignItems:\"center\"}},/*#__PURE__*/React.createElement(Grid,{item:true,xs:9},/*#__PURE__*/React.createElement(\"span\",null,\"Already have an account?\")),/*#__PURE__*/React.createElement(Grid,{item:true,xs:3},/*#__PURE__*/React.createElement(MButton,{onClick:onSwitchToLogin,style:{height:\"100%\"}},\"Login\")))));};","map":{"version":3,"sources":["/Users/johnny/IC/Computing/year2/DRP/drp48/src/components/auth/Register.tsx"],"names":["React","useContext","useState","Dialog","DialogTitle","DialogContent","TextField","MButton","DialogActions","Grid","userService","LoginContext","Divider","LinearProgress","RegisterDialogue","open","onClose","onSwitchToLogin","logins","isUsernameValid","setUsernameValid","username","setUsername","isEmailValid","setEmailValid","email","setEmail","isPasswordValid","setPasswordValid","password","setPassword","isLoading","setLoading","isFirstTime","setFirstTime","checkEmail","re","ok","test","String","toLowerCase","checkUsername","length","includes","checkPassword","submit","register","toggleSetUser","then","res","login","alert","resp","style","backgroundColor","boxShadow","borderRadius","backdropFilter","event","target","value","textAlign","marginTop","width","color","undefined","justifyItems","alignItems","height"],"mappings":"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","sourcesContent":["import React, { useContext, useState } from \"react\";\nimport Dialog from \"@material-ui/core/Dialog/Dialog\";\nimport DialogTitle from \"@material-ui/core/DialogTitle/DialogTitle\";\nimport DialogContent from \"@material-ui/core/DialogContent/DialogContent\";\nimport TextField from \"@material-ui/core/TextField/TextField\";\nimport MButton from \"@material-ui/core/Button\";\nimport DialogActions from \"@material-ui/core/DialogActions/DialogActions\";\nimport Grid from \"@material-ui/core/Grid/Grid\";\nimport { userService } from \"../../services/user.service\";\nimport { LoginContext } from \"../../LoginContext\";\nimport { Divider, LinearProgress } from \"@material-ui/core\";\n\ninterface LoginProps {\n  open: boolean;\n  onClose: () => void;\n  onSwitchToLogin: () => void;\n}\n\nexport const RegisterDialogue = ({\n  open,\n  onClose,\n  onSwitchToLogin,\n}: LoginProps) => {\n  const logins = useContext(LoginContext);\n\n  const [isUsernameValid, setUsernameValid] = useState(false);\n  const [username, setUsername] = useState(\"\");\n  const [isEmailValid, setEmailValid] = useState(false);\n  const [email, setEmail] = useState(\"\");\n  const [isPasswordValid, setPasswordValid] = useState(false);\n  const [password, setPassword] = useState(\"\");\n  const [isLoading, setLoading] = useState(false);\n  const [isFirstTime, setFirstTime] = useState(true);\n\n  const checkEmail = () => {\n    const re = /^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n    const ok = re.test(String(email).toLowerCase());\n    setEmailValid(ok);\n    return ok;\n  };\n\n  const checkUsername = () => {\n    const ok =\n      username.length >= 2 && username.length <= 50 && !username.includes(\";\");\n    setUsernameValid(ok);\n    return ok;\n  };\n\n  const checkPassword = () => {\n    const ok = password.length >= 4;\n    setPasswordValid(ok);\n    return ok;\n  };\n\n  const submit = () => {\n    if (checkEmail() && checkUsername() && checkPassword()) {\n      setLoading(true);\n      userService\n        .register(username, email, password, logins.toggleSetUser)\n        .then((res) => {\n          if (res) {\n            userService\n              .login(username, password, logins.toggleSetUser, () =>\n                alert(\"login error\")\n              )\n              .then((resp) => {\n                setLoading(false);\n                if (resp) {\n                  onClose();\n                }\n              });\n          } else {\n            alert(\"Register error\");\n            setLoading(false);\n          }\n        });\n    }\n  };\n\n  return (\n    <Dialog\n      open={open}\n      onClose={onClose}\n      aria-labelledby=\"form-dialog-title\"\n      PaperProps={{\n        style: {\n          backgroundColor: \"rgba(255, 255, 255, .70)\",\n          boxShadow: \"inset 0 0 1rem 0 rgba(0, 0, 0, .2)\",\n          borderRadius: \"5px\",\n          backdropFilter: \"blur(7px)\",\n        },\n      }}\n    >\n      <DialogTitle id=\"form-dialog-title\">Sign Up</DialogTitle>\n      <DialogContent>\n        <div>\n          <TextField\n            required\n            id=\"standard-required\"\n            label=\"Username\"\n            onChange={(event) => setUsername(event.target.value)}\n            error={!isUsernameValid && !isFirstTime}\n            helperText={\n              isUsernameValid || isFirstTime\n                ? \"\"\n                : \"Username must contain 2 ~ 50 valid characters\"\n            }\n          />\n        </div>\n        <div>\n          <TextField\n            required\n            id=\"standard-required\"\n            label=\"Email\"\n            onChange={(event) => setEmail(event.target.value)}\n            error={!isEmailValid && !isFirstTime}\n            helperText={\n              isEmailValid || isFirstTime ? \"\" : \"Must be a valid email address\"\n            }\n          />\n        </div>\n\n        <div>\n          <TextField\n            required\n            id=\"standard-password-input\"\n            label=\"Password\"\n            type=\"password\"\n            autoComplete=\"current-password\"\n            onChange={(event) => setPassword(event.target.value)}\n            error={!isPasswordValid && !isFirstTime}\n            helperText={\n              isPasswordValid || isFirstTime\n                ? \"\"\n                : \"Password must contain more than 4 characters\"\n            }\n          />\n        </div>\n        <div style={{ textAlign: \"right\", marginTop: \"10px\" }}>\n          <MButton\n            style={{ width: \"100%\", backgroundColor: \"green\", color: \"white\" }}\n            onClick={submit}\n          >\n            SUBMIT\n          </MButton>\n          {isLoading ? <LinearProgress /> : undefined}\n        </div>\n      </DialogContent>\n      <Divider />\n      <DialogActions>\n        <Grid\n          container\n          style={{ justifyItems: \"center\", alignItems: \"center\" }}\n        >\n          <Grid item xs={9}>\n            <span>Already have an account?</span>\n          </Grid>\n          <Grid item xs={3}>\n            <MButton onClick={onSwitchToLogin} style={{ height: \"100%\" }}>\n              Login\n            </MButton>\n          </Grid>\n        </Grid>\n      </DialogActions>\n    </Dialog>\n  );\n};\n"]},"metadata":{},"sourceType":"module"}