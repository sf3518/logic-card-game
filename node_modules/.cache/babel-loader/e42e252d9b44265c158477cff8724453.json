{"ast":null,"code":"var _jsxFileName = \"/Users/johnny/IC/Computing/DRP/drp48/src/components/editor/LevelEditor.tsx\";\nimport React, { useContext, useState, useEffect } from 'react';\nimport { LoginContext } from '../../LoginContext';\nimport { useStyles } from '../appbar';\nimport { onIndex, moveFromTo, deleteCardAt, addHandCard, getAHandCard, insertCardTo, onGoalJson, moveWithin, deleteHandCard, changeCountHandCard } from './editorUtils';\nimport { EditorPremise } from './EditorPremise';\nimport { EditorHand } from './EditorHand';\nimport AppBar from '@material-ui/core/AppBar/AppBar';\nimport { parseGoalTreeSafe, getExprFromJson } from '../../server/gameApp/game/goal';\nimport { evalSuccess } from '../../game/views';\nimport { EditorGoal } from './EditorGoals';\nimport { EditorAllCards } from './EditorAllCards';\nimport Axios from 'axios';\nimport { Paths } from '../../routesPaths';\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogTitle from '@material-ui/core/DialogTitle/DialogTitle';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport MButton from '@material-ui/core/Button';\nimport Divider from '@material-ui/core/Divider';\nimport Toolbar from '@material-ui/core/Toolbar';\nimport Typography from '@material-ui/core/Typography';\nimport IconButton from '@material-ui/core/IconButton';\nimport Drawer from '@material-ui/core/Drawer';\nimport List from '@material-ui/core/List';\nimport ListItem from '@material-ui/core/ListItem';\nimport ListItemText from '@material-ui/core/ListItemText';\nimport { LinkContainer } from 'react-router-bootstrap';\nimport MenuIcon from '@material-ui/icons/Menu';\nimport AddIcon from '@material-ui/icons/Add';\nimport EditIcon from '@material-ui/icons/Edit';\nimport UndoIcon from '@material-ui/icons/Undo';\nimport RemoveIcon from '@material-ui/icons/Remove';\nimport FeedbackIcon from '@material-ui/icons/Feedback';\nimport PublishIcon from '@material-ui/icons/Publish';\nimport { ChangeGoalDialogue } from './ChangeGoalDialogue';\nimport { Fab, Grid, Tooltip, GridList, GridListTile, BottomNavigation, TextField, LinearProgress } from '@material-ui/core';\nimport { EditorModifyCardCountDialogue } from './EditorModifyCardCount';\nimport { parsePremiseSafe } from '../../server/gameApp/game/premise';\nimport { DescEditorDialogue } from './DescEditorDialogue';\nimport { TruthTable } from '../game/Truthtable';\nexport const EditorContext = React.createContext({\n  state: {\n    kind: 'idle'\n  },\n  premises: [],\n  handCards: [],\n  goals: [],\n  lockedPremises: [],\n  goalTrees: [],\n  setIdle: () => {}\n});\nexport const LevelEditor = () => {\n  const classes = useStyles();\n  const logins = useContext(LoginContext);\n  const [title, setTitle] = useState(\"A new level\");\n  const [desc, setDesc] = useState([]);\n  const [state, setState] = useState({\n    kind: 'idle'\n  });\n  const [premises, setPremises] = useState([[], [], [], []]);\n  const [lockedPremises, setLockedPremises] = useState([0, 2, 3]);\n  const [handCards, setHandCards] = useState([]);\n  const [goals, setGoals] = useState([{\n    kind: 'prove',\n    expr: ['A']\n  }]);\n  const [goalTrees, setGoalTrees] = useState([]);\n  const [isSuccess, setSuccess] = useState(premises.map(_ => false));\n  const [history, setHistory] = useState([]);\n  const [isShowDrawer, setShowDrawer] = useState(false);\n  const [isShowTruthTable, setShowTruthTable] = useState(false);\n  const [isChangeDesc, setChangeDesc] = useState(false);\n  const [onConfirm, setOnConfirm] = useState(false);\n  const [onSubmit, setOnSubmit] = useState(false);\n  const [onModifyCardPos, setModifyCardPos] = useState(0); // set goalTrees on goals change\n\n  useEffect(() => {\n    const trees = goals.map(g => parseGoalTreeSafe(g));\n    setGoalTrees(trees);\n    console.log(trees);\n    const gs = goals.map((g, i) => {\n      switch (g.kind) {\n        case 'paradox':\n        case 'tautology':\n          return {\n            kind: g.kind,\n            expr: undefined,\n            boolTree: undefined\n          };\n\n        default:\n          return trees[i] ? {\n            kind: g.kind,\n            expr: g.expr,\n            boolTree: trees[i]\n          } : undefined;\n      }\n    });\n    setSuccess(evalSuccess(premises, gs));\n  }, [goals, premises]);\n\n  const evictJson = () => {\n    const cards = [];\n    const limitedCards = [];\n    handCards.forEach(([card, count]) => {\n      if (count == Number.POSITIVE_INFINITY) {\n        cards.push(card);\n      } else {\n        limitedCards.push([card, count]);\n      }\n    });\n    return {\n      title: title,\n      premises: premises,\n      lockedPremises: lockedPremises,\n      cards: cards,\n      limitedCards: limitedCards,\n      goals: goals,\n      description: desc\n    };\n  }; // state handlers\n\n\n  const setSelect = select => {\n    setState({\n      kind: 'select',\n      select: select\n    });\n  };\n\n  const setIdle = () => setState({\n    kind: 'idle'\n  });\n\n  const setHandCardCount = (hpos, count) => {\n    const hcs = changeCountHandCard(hpos, count)(handCards).state;\n    setHandCards(hcs);\n    setIdle();\n  };\n\n  const setLockPremise = i => {\n    if (lockedPremises.includes(i)) {\n      setLockedPremises(lockedPremises.filter(j => j != i));\n    } else {\n      setLockedPremises(lockedPremises.concat(i));\n    }\n  };\n\n  const setAddGoal = () => {\n    setGoals(goals.concat({\n      kind: 'prove',\n      expr: []\n    }));\n  };\n\n  const setRemoveGoal = gid => {\n    setGoals(goals.filter((_, i) => gid != i));\n  };\n\n  const setModifyGoal = (gid, goal) => {\n    setGoals(goals.map((g, i) => i == gid ? goal : g));\n  };\n\n  const setOpenHandCardEditor = i => {\n    setModifyCardPos(i);\n    setState({\n      kind: 'changeHand'\n    });\n  };\n\n  const pushHistory = () => {\n    const curr = {\n      premises: premises,\n      lockedPremises: lockedPremises,\n      handCards: handCards,\n      goals: goals\n    };\n    setHistory([curr].concat(history));\n  };\n\n  const undoHistory = () => {\n    if (history.length > 0) {\n      const last = history[0];\n      setHistory(history.slice(1));\n      setPremises(last.premises);\n      setLockedPremises(last.lockedPremises);\n      setHandCards(last.handCards);\n      setGoals(last.goals);\n    }\n  }; // Drop event handlers\n\n\n  const onDropToPremise = (pid, ppos) => {\n    if (state.kind === 'select') {\n      const select = state.select;\n\n      switch (select.kind) {\n        case 'premise':\n          {\n            const ps = moveWithin(premises, onIndex(select.pid, deleteCardAt(select.ppos)), card => onIndex(pid, insertCardTo(card, ppos)));\n            setPremises(ps);\n            break;\n          }\n\n        case 'hand':\n          {\n            const [hcs, ps] = moveFromTo(handCards, getAHandCard(select.hpos), premises, card => onIndex(pid, insertCardTo(card, ppos)));\n            setPremises(ps);\n            setHandCards(hcs);\n            break;\n          }\n\n        case 'goal':\n          {\n            const [gs, ps] = moveFromTo(goals, onIndex(select.gid, onGoalJson(deleteCardAt(select.gpos))), premises, card => onIndex(pid, insertCardTo(card, ppos)));\n            setGoals(gs);\n            setPremises(ps);\n            break;\n          }\n\n        case 'all':\n          {\n            const ps = onIndex(pid, insertCardTo(select.card, ppos))(premises).state;\n            setPremises(ps);\n            break;\n          }\n      }\n\n      pushHistory();\n      setIdle();\n    }\n  };\n\n  const onDropToHand = () => {\n    if (state.kind === 'select') {\n      const select = state.select;\n\n      switch (select.kind) {\n        case 'premise':\n          {\n            const [ps, hcs] = moveFromTo(premises, onIndex(select.pid, deleteCardAt(select.ppos)), handCards, card => addHandCard(card, 1));\n            setPremises(ps);\n            setHandCards(hcs);\n            break;\n          }\n\n        case 'hand':\n          {\n            const hcs = moveWithin(handCards, getAHandCard(select.hpos), card => addHandCard(card, 1));\n            setHandCards(hcs);\n            break;\n          }\n\n        case 'goal':\n          {\n            const [gs, hcs] = moveFromTo(goals, onIndex(select.gid, onGoalJson(deleteCardAt(select.gpos))), handCards, card => addHandCard(card, 1));\n            setGoals(gs);\n            setHandCards(hcs);\n            break;\n          }\n\n        case 'all':\n          {\n            const ps = addHandCard(select.card, 1)(handCards).state;\n            setHandCards(ps);\n            break;\n          }\n      }\n\n      pushHistory();\n      setIdle();\n    }\n  };\n\n  const onDropToGoal = (gid, gpos) => {\n    if (state.kind === 'select') {\n      const select = state.select;\n\n      switch (select.kind) {\n        case 'premise':\n          {\n            const [ps, gs] = moveFromTo(premises, onIndex(select.pid, deleteCardAt(select.ppos)), goals, card => onIndex(gid, onGoalJson(insertCardTo(card, gpos))));\n            setPremises(ps);\n            setGoals(gs);\n            break;\n          }\n\n        case 'hand':\n          {\n            const [hcs, gs] = moveFromTo(handCards, getAHandCard(select.hpos), goals, card => onIndex(gid, onGoalJson(insertCardTo(card, gpos))));\n            setHandCards(hcs);\n            setGoals(gs);\n            break;\n          }\n\n        case 'goal':\n          {\n            const gs = moveWithin(goals, onIndex(select.gid, onGoalJson(deleteCardAt(select.gpos))), card => onIndex(gid, onGoalJson(insertCardTo(card, gpos))));\n            setGoals(gs);\n            break;\n          }\n\n        case 'all':\n          {\n            const gs = onIndex(gid, onGoalJson(insertCardTo(select.card, gpos)))(goals).state;\n            setGoals(gs);\n            break;\n          }\n      }\n\n      pushHistory();\n      setIdle();\n    }\n  };\n\n  const onDropToAllCards = () => {\n    if (state.kind === 'select') {\n      const select = state.select;\n\n      switch (select.kind) {\n        case 'premise':\n          {\n            const ps = onIndex(select.pid, deleteCardAt(select.ppos))(premises).state;\n            setPremises(ps);\n            break;\n          }\n\n        case 'hand':\n          {\n            const hcs = deleteHandCard(select.hpos)(handCards).state;\n            setHandCards(hcs);\n            break;\n          }\n\n        case 'goal':\n          {\n            const gs = onIndex(select.gid, onGoalJson(deleteCardAt(select.gpos)))(goals).state;\n            setGoals(gs);\n            break;\n          }\n\n        case 'all':\n          {\n            break;\n          }\n      }\n\n      pushHistory();\n      setIdle();\n    }\n  }; // misc actions\n\n\n  const toggleDrawer = open => event => {\n    if (event.type === 'keydown' && (event.key === 'Tab' || event.key === 'Shift')) {\n      return;\n    }\n\n    setShowDrawer(open);\n  };\n\n  const toggleConfirm = () => {\n    if (logins.user === undefined) {\n      alert(\"You need to login first!\");\n      logins.onLogin();\n    } else if (goals.length > 0 && goals.map(g => getExprFromJson(g)).every(expr => parsePremiseSafe(expr) !== undefined) && handCards.length > 0) {\n      setOnConfirm(true);\n    } else {\n      alert(\"This is not a valid level!\");\n    }\n  }; // post to server\n\n\n  const postJsonToServer = () => {\n    const data = {\n      user: logins.user,\n      level: evictJson()\n    };\n    setOnSubmit(true);\n    Axios.post(Paths.submitLevelJson, data).then(() => alert(\"Submission successful!\")).catch(err => alert(err)).finally(() => {\n      setOnSubmit(false);\n      setOnConfirm(false);\n    });\n  }; // rendering\n\n\n  const renderAppBar = () => /*#__PURE__*/React.createElement(AppBar, {\n    position: \"static\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 407,\n      columnNumber: 30\n    }\n  }, /*#__PURE__*/React.createElement(Toolbar, {\n    style: {\n      backgroundColor: '#F2994A'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 408,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Typography, {\n    variant: \"h6\",\n    className: classes.title,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 409,\n      columnNumber: 7\n    }\n  }, title, /*#__PURE__*/React.createElement(Tooltip, {\n    title: \"Edit level name and description\",\n    arrow: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 411,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(IconButton, {\n    onClick: () => setChangeDesc(true),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 412,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(EditIcon, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 413,\n      columnNumber: 13\n    }\n  })))), /*#__PURE__*/React.createElement(IconButton, {\n    edge: \"start\",\n    className: classes.menuButton,\n    color: \"inherit\",\n    \"aria-label\": \"menu\",\n    onClick: toggleDrawer(true),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 417,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(MenuIcon, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 424,\n      columnNumber: 9\n    }\n  })), /*#__PURE__*/React.createElement(Drawer, {\n    anchor: \"right\",\n    open: isShowDrawer,\n    onClose: toggleDrawer(false),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 426,\n      columnNumber: 7\n    }\n  }, renderDrawerContent())));\n\n  const renderDrawerContent = () => {\n    const menu = /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 433,\n        columnNumber: 18\n      }\n    }, /*#__PURE__*/React.createElement(List, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 434,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(LinkContainer, {\n      to: \"/\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 435,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(ListItem, {\n      button: true,\n      key: \"menu\",\n      onClick: () => {},\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 436,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(ListItemText, {\n      primary: \"Back to Main Menu\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 437,\n        columnNumber: 13\n      }\n    })))));\n    return menu;\n  };\n\n  const renderPremise = i => /*#__PURE__*/React.createElement(EditorPremise, {\n    category: {\n      kind: 'premise',\n      index: i\n    },\n    scale: 1,\n    onLock: () => setLockPremise(i),\n    onSelect: ppos => setSelect({\n      kind: 'premise',\n      pid: i,\n      ppos: ppos\n    }),\n    onDrop: ppos => onDropToPremise(i, ppos),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 445,\n      columnNumber: 40\n    }\n  });\n\n  const renderPremises = () => premises.map((_, i) => renderPremise(i));\n\n  const renderHand = () => /*#__PURE__*/React.createElement(EditorHand, {\n    onPick: hpos => setSelect({\n      kind: 'hand',\n      hpos: hpos\n    }),\n    onClickOnTag: setOpenHandCardEditor,\n    onDrop: onDropToHand,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 455,\n      columnNumber: 28\n    }\n  });\n\n  const renderModifyCardCount = () => /*#__PURE__*/React.createElement(EditorModifyCardCountDialogue, {\n    hpos: onModifyCardPos,\n    onSubmit: c => {\n      setHandCardCount(onModifyCardPos, c);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 462,\n      columnNumber: 5\n    }\n  });\n\n  const renderGoal = () => /*#__PURE__*/React.createElement(GridListTile, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 469,\n      columnNumber: 28\n    }\n  }, /*#__PURE__*/React.createElement(EditorGoal, {\n    isSuccessful: isSuccess,\n    onSelect: (gid, gpos) => setSelect({\n      kind: 'goal',\n      gid: gid,\n      gpos: gpos\n    }),\n    onDrop: onDropToGoal,\n    onChange: gid => setState({\n      kind: 'changeGoal',\n      gid: gid,\n      newGoal: goals[gid]\n    }),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 470,\n      columnNumber: 5\n    }\n  }));\n\n  const renderGoals = () => {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 479,\n        columnNumber: 12\n      }\n    }, renderGoal(), /*#__PURE__*/React.createElement(\"div\", {\n      style: {\n        width: '40',\n        textAlign: 'left',\n        marginBottom: '20px',\n        marginRight: '70px',\n        position: 'absolute',\n        right: '0'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 481,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(Tooltip, {\n      title: \"Add a new goal\",\n      \"aria-label\": \"add\",\n      arrow: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 482,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(Fab, {\n      style: {\n        left: 40,\n        backgroundColor: '#F2994A',\n        color: '#fff'\n      },\n      onClick: setAddGoal,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 483,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(AddIcon, {\n      style: {\n        fontSize: '30'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 484,\n        columnNumber: 13\n      }\n    }))), /*#__PURE__*/React.createElement(Tooltip, {\n      title: \"Delete the last goal\",\n      \"aria-label\": \"del\",\n      arrow: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 487,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(Fab, {\n      style: {\n        left: 40,\n        backgroundColor: '#A359A3',\n        color: '#fff',\n        margin: '20px'\n      },\n      onClick: () => setRemoveGoal(goals.length - 1),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 488,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(RemoveIcon, {\n      style: {\n        fontSize: '30'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 492,\n        columnNumber: 13\n      }\n    })))), /*#__PURE__*/React.createElement(ChangeGoalDialogue, {\n      updateGoal: g => setState({\n        kind: 'changeGoal',\n        gid: state.kind == 'changeGoal' ? state.gid : -1,\n        newGoal: g\n      }),\n      confirmGoal: () => {\n        if (state.kind == 'changeGoal') {\n          setModifyGoal(state.gid, state.newGoal);\n        }\n      },\n      deleteGoal: gid => setRemoveGoal(gid),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 496,\n        columnNumber: 7\n      }\n    }));\n  };\n\n  const renderTruthTable = () => /*#__PURE__*/React.createElement(Dialog, {\n    open: isShowTruthTable,\n    onClose: () => setShowTruthTable(false),\n    title: \"Truth Table\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 509,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(TruthTable, {\n    premises: premises,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 514,\n      columnNumber: 7\n    }\n  }));\n\n  const renderAllCardsList = () => /*#__PURE__*/React.createElement(EditorAllCards, {\n    onSelect: c => setSelect({\n      kind: 'all',\n      card: c\n    }),\n    onDrop: onDropToAllCards,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 518,\n      columnNumber: 36\n    }\n  });\n\n  const renderConfirmation = () => /*#__PURE__*/React.createElement(Dialog, {\n    open: onConfirm,\n    onClose: () => setOnConfirm(false),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 524,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(DialogTitle, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 525,\n      columnNumber: 7\n    }\n  }, \"Submit\"), /*#__PURE__*/React.createElement(DialogContent, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 526,\n      columnNumber: 7\n    }\n  }, \"Are you sure you want to submit your level?\", /*#__PURE__*/React.createElement(GridList, {\n    cols: 1,\n    style: {\n      width: '300px',\n      height: '200px',\n      marginTop: '10px'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 528,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(GridListTile, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 529,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(TextField, {\n    id: \"outlined-read-only-input\",\n    label: \"Level Setup in JSON\",\n    multiline: true,\n    defaultValue: JSON.stringify(evictJson()),\n    InputProps: {\n      readOnly: true\n    },\n    style: {\n      marginTop: '20px'\n    },\n    variant: \"outlined\",\n    fullWidth: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 530,\n      columnNumber: 13\n    }\n  })))), /*#__PURE__*/React.createElement(Divider, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 545,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 546,\n      columnNumber: 7\n    }\n  }, onSubmit ? /*#__PURE__*/React.createElement(LinearProgress, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 546,\n      columnNumber: 25\n    }\n  }) : undefined), /*#__PURE__*/React.createElement(DialogActions, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 547,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(MButton, {\n    onClick: postJsonToServer,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 548,\n      columnNumber: 9\n    }\n  }, \"Confirm\")));\n\n  const renderFooter = () => /*#__PURE__*/React.createElement(BottomNavigation, {\n    value: 0,\n    showLabels: true,\n    className: classes.root,\n    style: {\n      width: '100%',\n      position: 'sticky',\n      bottom: 0\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 552,\n      columnNumber: 30\n    }\n  }, /*#__PURE__*/React.createElement(MButton, {\n    startIcon: /*#__PURE__*/React.createElement(UndoIcon, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 562,\n        columnNumber: 25\n      }\n    }),\n    onClick: undoHistory,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 562,\n      columnNumber: 5\n    }\n  }, \"UNDO ONE STEP\"), /*#__PURE__*/React.createElement(MButton, {\n    startIcon: /*#__PURE__*/React.createElement(EditIcon, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 563,\n        columnNumber: 25\n      }\n    }),\n    onClick: () => setChangeDesc(true),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 563,\n      columnNumber: 5\n    }\n  }, \"EDIT DESCRIPTION\"), /*#__PURE__*/React.createElement(MButton, {\n    startIcon: /*#__PURE__*/React.createElement(FeedbackIcon, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 564,\n        columnNumber: 25\n      }\n    }),\n    onClick: () => setShowTruthTable(true),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 564,\n      columnNumber: 5\n    }\n  }, \"SHOW TRUTH TABLE\"), /*#__PURE__*/React.createElement(MButton, {\n    startIcon: /*#__PURE__*/React.createElement(PublishIcon, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 565,\n        columnNumber: 25\n      }\n    }),\n    onClick: toggleConfirm,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 565,\n      columnNumber: 5\n    }\n  }, \"SUBMIT\"));\n\n  return /*#__PURE__*/React.createElement(EditorContext.Provider, {\n    value: {\n      state: state,\n      premises: premises,\n      handCards: handCards,\n      goals: goals,\n      lockedPremises: lockedPremises,\n      goalTrees: goalTrees,\n      setIdle: setIdle\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 569,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 578,\n      columnNumber: 7\n    }\n  }, renderAppBar(), renderPremises(), /*#__PURE__*/React.createElement(Divider, {\n    style: {\n      margin: '10px'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 581,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(Grid, {\n    container: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 582,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 4,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 583,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(GridList, {\n    cols: 1,\n    style: {\n      flexWrap: 'nowrap',\n      transform: 'translateZ(0)',\n      height: '220px'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 584,\n      columnNumber: 13\n    }\n  }, renderGoals())), /*#__PURE__*/React.createElement(Divider, {\n    orientation: \"vertical\",\n    flexItem: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 588,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 4,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 589,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(GridList, {\n    cols: 1,\n    style: {\n      flexWrap: 'nowrap',\n      transform: 'translateZ(0)',\n      height: '220px'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 590,\n      columnNumber: 13\n    }\n  }, renderHand())), /*#__PURE__*/React.createElement(Divider, {\n    orientation: \"vertical\",\n    flexItem: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 594,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    alignContent: \"center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 595,\n      columnNumber: 11\n    }\n  }, renderAllCardsList())), renderFooter(), renderConfirmation(), renderModifyCardCount(), renderTruthTable(), /*#__PURE__*/React.createElement(DescEditorDialogue, {\n    open: isChangeDesc,\n    title: title,\n    desc: desc,\n    onSubmit: (title, desc) => {\n      setTitle(title);\n      setDesc(desc);\n    },\n    onCancel: () => setChangeDesc(false),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 603,\n      columnNumber: 9\n    }\n  })));\n};","map":{"version":3,"sources":["/Users/johnny/IC/Computing/DRP/drp48/src/components/editor/LevelEditor.tsx"],"names":["React","useContext","useState","useEffect","LoginContext","useStyles","onIndex","moveFromTo","deleteCardAt","addHandCard","getAHandCard","insertCardTo","onGoalJson","moveWithin","deleteHandCard","changeCountHandCard","EditorPremise","EditorHand","AppBar","parseGoalTreeSafe","getExprFromJson","evalSuccess","EditorGoal","EditorAllCards","Axios","Paths","Dialog","DialogTitle","DialogContent","DialogActions","MButton","Divider","Toolbar","Typography","IconButton","Drawer","List","ListItem","ListItemText","LinkContainer","MenuIcon","AddIcon","EditIcon","UndoIcon","RemoveIcon","FeedbackIcon","PublishIcon","ChangeGoalDialogue","Fab","Grid","Tooltip","GridList","GridListTile","BottomNavigation","TextField","LinearProgress","EditorModifyCardCountDialogue","parsePremiseSafe","DescEditorDialogue","TruthTable","EditorContext","createContext","state","kind","premises","handCards","goals","lockedPremises","goalTrees","setIdle","LevelEditor","classes","logins","title","setTitle","desc","setDesc","setState","setPremises","setLockedPremises","setHandCards","setGoals","expr","setGoalTrees","isSuccess","setSuccess","map","_","history","setHistory","isShowDrawer","setShowDrawer","isShowTruthTable","setShowTruthTable","isChangeDesc","setChangeDesc","onConfirm","setOnConfirm","onSubmit","setOnSubmit","onModifyCardPos","setModifyCardPos","trees","g","console","log","gs","i","undefined","boolTree","evictJson","cards","limitedCards","forEach","card","count","Number","POSITIVE_INFINITY","push","description","setSelect","select","setHandCardCount","hpos","hcs","setLockPremise","includes","filter","j","concat","setAddGoal","setRemoveGoal","gid","setModifyGoal","goal","setOpenHandCardEditor","pushHistory","curr","undoHistory","length","last","slice","onDropToPremise","pid","ppos","ps","gpos","onDropToHand","onDropToGoal","onDropToAllCards","toggleDrawer","open","event","type","key","toggleConfirm","user","alert","onLogin","every","postJsonToServer","data","level","post","submitLevelJson","then","catch","err","finally","renderAppBar","backgroundColor","menuButton","renderDrawerContent","menu","renderPremise","index","renderPremises","renderHand","renderModifyCardCount","c","renderGoal","newGoal","renderGoals","width","textAlign","marginBottom","marginRight","position","right","left","color","fontSize","margin","renderTruthTable","renderAllCardsList","renderConfirmation","height","marginTop","JSON","stringify","readOnly","renderFooter","root","bottom","flexWrap","transform"],"mappings":"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","sourcesContent":["import React, { useContext, useState, useEffect } from 'react'\nimport { LoginContext } from '../../LoginContext'\nimport { Premise, GoalInJSON, Card, Goal, LevelSetupJsonFormat } from '../../types'\nimport { useStyles } from '../appbar'\nimport { \n  onIndex, \n  moveFromTo, \n  deleteCardAt, \n  addHandCard, \n  getAHandCard, \n  insertCardTo, \n  onGoalJson, \n  moveWithin, \n  deleteHandCard, \n  changeCountHandCard } from './editorUtils'\nimport { EditorPremise } from './EditorPremise'\nimport { EditorHand } from './EditorHand'\nimport { BoolTree } from '../../server/gameApp/logicResolver/bools'\nimport AppBar from '@material-ui/core/AppBar/AppBar'\nimport { fromGoalJson, parseGoalTreeSafe, getExprFromJson } from '../../server/gameApp/game/goal'\nimport { evalSuccess } from '../../game/views'\nimport { EditorGoal } from './EditorGoals'\nimport { EditorAllCards } from './EditorAllCards'\nimport Axios, { AxiosRequestConfig } from 'axios'\nimport { Paths } from '../../routesPaths'\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogTitle from '@material-ui/core/DialogTitle/DialogTitle'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport DialogActions from '@material-ui/core/DialogActions'\nimport MButton from '@material-ui/core/Button'\nimport Divider from '@material-ui/core/Divider'\nimport Toolbar from '@material-ui/core/Toolbar'\nimport Typography from '@material-ui/core/Typography'\nimport IconButton from '@material-ui/core/IconButton'\nimport Drawer from '@material-ui/core/Drawer'\nimport List from '@material-ui/core/List'\nimport ListItem from '@material-ui/core/ListItem'\nimport ListItemText from '@material-ui/core/ListItemText'\nimport { LinkContainer } from 'react-router-bootstrap'\nimport MenuIcon from '@material-ui/icons/Menu'\nimport AddIcon from '@material-ui/icons/Add'\nimport EditIcon from '@material-ui/icons/Edit'\nimport UndoIcon from '@material-ui/icons/Undo'\nimport RemoveIcon from '@material-ui/icons/Remove'\nimport FeedbackIcon from '@material-ui/icons/Feedback'\nimport PublishIcon from '@material-ui/icons/Publish'\nimport { ChangeGoalDialogue } from './ChangeGoalDialogue'\nimport { Fab, Grid, Tooltip, GridList, GridListTile, BottomNavigation, TextField, LinearProgress } from '@material-ui/core'\nimport { EditorModifyCardCountDialogue } from './EditorModifyCardCount'\nimport { parsePremiseSafe } from '../../server/gameApp/game/premise'\nimport { DescEditorDialogue } from './DescEditorDialogue'\nimport { TruthTable } from '../game/Truthtable'\n\n\ntype EditorState = { kind: 'idle' }\n                 | { kind: 'changeHand' }\n                 | { kind: 'select', select: SelectState }\n                 | { kind: 'changeGoal', gid: number, newGoal: GoalInJSON }\n\ntype SelectState = { kind: 'premise', pid: number, ppos: number }\n                 | { kind: 'hand', hpos: number }\n                 | { kind: 'goal', gid: number, gpos: number }\n                 | { kind: 'all', card: Card }\n\ninterface EditorHistory {\n  premises: Premise[]\n  lockedPremises: number[]\n  handCards: [Card, number][]\n  goals: GoalInJSON[]\n}\n\ntype EditorContexts = {\n  state: EditorState\n  premises: Premise[]\n  handCards: [Card, number][]\n  goals: GoalInJSON[]\n  goalTrees: (BoolTree | undefined)[]\n  lockedPremises: number[]\n  setIdle: () => void\n}\n\nexport const EditorContext = React.createContext<EditorContexts>({\n  state: { kind: 'idle' },\n  premises: [],\n  handCards: [],\n  goals: [],\n  lockedPremises: [],\n  goalTrees: [],\n  setIdle: () => {}\n})\n\nexport const LevelEditor = () => {\n  const classes = useStyles()\n  const logins = useContext(LoginContext)\n\n  const [title, setTitle] = useState(\"A new level\")\n  const [desc, setDesc] = useState<string[]>([])\n  const [state, setState] = useState<EditorState>({ kind: 'idle' })\n  const [premises, setPremises] = useState<Premise[]>([[], [], [], []])\n  const [lockedPremises, setLockedPremises] = useState<number[]>([0,2,3])\n  const [handCards, setHandCards] = useState<[Card, number][]>([])\n  const [goals, setGoals] = useState<GoalInJSON[]>([{ kind: 'prove', expr: ['A']}])\n  const [goalTrees, setGoalTrees] = useState<(BoolTree|undefined)[]>([])\n  const [isSuccess, setSuccess] = useState<boolean[]>(premises.map(_ => false))\n  const [history, setHistory] = useState<EditorHistory[]>([])\n\n  const [isShowDrawer, setShowDrawer] = useState(false)\n  const [isShowTruthTable, setShowTruthTable] = useState(false)\n  const [isChangeDesc, setChangeDesc] = useState(false)\n  const [onConfirm, setOnConfirm] = useState(false)\n  const [onSubmit, setOnSubmit] = useState(false)\n  const [onModifyCardPos, setModifyCardPos] = useState<number>(0)\n\n  // set goalTrees on goals change\n  useEffect(() => {\n    const trees = goals.map(g => parseGoalTreeSafe(g))\n    setGoalTrees(trees)\n    console.log(trees)\n    \n    const gs: (Goal | undefined)[] = goals.map((g, i) => { \n      switch (g.kind) {\n        case 'paradox':\n        case 'tautology':\n          return { kind: g.kind, expr: undefined, boolTree: undefined }      \n        default:\n          return trees[i] ? { kind: g.kind, expr: g.expr, boolTree: trees[i]! } : undefined\n      }\n    })\n    setSuccess(evalSuccess(premises, gs))\n  }, [goals, premises])\n\n  const evictJson = (): LevelSetupJsonFormat => {\n    const cards: Card[] = []\n    const limitedCards: [Card, number][] = []\n    handCards.forEach(([card, count]) => {\n      if (count == Number.POSITIVE_INFINITY) {\n        cards.push(card)\n      } else {\n        limitedCards.push([card, count])\n      }\n    })\n\n    return {\n      title: title,\n      premises: premises,\n      lockedPremises: lockedPremises,  \n      cards: cards,\n      limitedCards: limitedCards,\n      goals: goals,\n      description: desc\n    }\n  }\n\n  // state handlers\n\n  const setSelect = (select: SelectState) => {\n    setState({ kind: 'select', select: select })\n  }\n\n  const setIdle = () => setState({ kind: 'idle' })\n\n  const setHandCardCount = (hpos: number, count: number) => {\n    const hcs = changeCountHandCard(hpos, count)(handCards).state\n    setHandCards(hcs)\n    setIdle()\n  }\n\n  const setLockPremise = (i: number) => {\n    if (lockedPremises.includes(i)) {\n      setLockedPremises(lockedPremises.filter(j => j != i))\n    } else {\n      setLockedPremises(lockedPremises.concat(i))\n    }\n  }\n\n  const setAddGoal = () => {\n    setGoals(goals.concat({ kind: 'prove', expr: [] }))    \n  }\n\n  const setRemoveGoal = (gid: number) => {\n    setGoals(goals.filter((_, i) => gid != i))\n  }\n\n  const setModifyGoal = (gid: number, goal: GoalInJSON) => {\n    setGoals(goals.map((g, i) => i == gid ? goal : g))\n  }\n\n  const setOpenHandCardEditor = (i: number) => {\n    setModifyCardPos(i)\n    setState({ kind: 'changeHand' })\n  }\n\n  const pushHistory = () => {\n    const curr: EditorHistory = {\n      premises: premises,\n      lockedPremises: lockedPremises,\n      handCards: handCards,\n      goals: goals\n    }\n    setHistory([curr].concat(history))\n  }\n\n  const undoHistory = () => {\n    if (history.length > 0) {\n      const last = history[0]\n      setHistory(history.slice(1))\n      setPremises(last.premises)\n      setLockedPremises(last.lockedPremises)\n      setHandCards(last.handCards)\n      setGoals(last.goals)\n    }\n  }\n\n  // Drop event handlers\n  const onDropToPremise = (pid: number, ppos: number) => {\n    if (state.kind === 'select') {\n      const select = state.select\n      switch (select.kind) {\n        case 'premise': {\n          const ps = moveWithin(premises, onIndex(select.pid, deleteCardAt(select.ppos)), card => onIndex(pid, insertCardTo(card, ppos)))\n          setPremises(ps)\n          break\n        } \n        case 'hand': {\n          const [hcs, ps] = moveFromTo(\n            handCards, getAHandCard(select.hpos), \n            premises, card => onIndex(pid, insertCardTo(card, ppos))\n          )\n          setPremises(ps)\n          setHandCards(hcs)\n          break\n        }\n        case 'goal': {\n          const [gs, ps] = moveFromTo(\n            goals, onIndex(select.gid, onGoalJson(deleteCardAt(select.gpos))),\n            premises, card => onIndex(pid, insertCardTo(card, ppos))\n          )\n          setGoals(gs)\n          setPremises(ps)\n          break\n        }\n        case 'all': {\n          const ps = onIndex(pid, insertCardTo(select.card, ppos))(premises).state\n          setPremises(ps)\n          break\n        }\n      }\n      pushHistory()\n      setIdle()\n    }\n  }\n\n  const onDropToHand = () => {\n    if (state.kind === 'select') {\n      const select = state.select\n      switch (select.kind) {\n        case 'premise': {\n          const [ps, hcs] = moveFromTo(\n            premises, onIndex(select.pid, deleteCardAt(select.ppos)), \n            handCards, card => addHandCard(card, 1)\n          )\n          setPremises(ps)\n          setHandCards(hcs)\n          break\n        } \n        case 'hand': {\n          const hcs = moveWithin(handCards, getAHandCard(select.hpos), card => addHandCard(card, 1))\n          setHandCards(hcs)\n          break\n        }\n        case 'goal': {\n          const [gs, hcs] = moveFromTo(\n            goals, onIndex(select.gid, onGoalJson(deleteCardAt(select.gpos))),\n            handCards, card => addHandCard(card, 1)\n          )\n          setGoals(gs)\n          setHandCards(hcs)\n          break\n        }\n        case 'all': {\n          const ps = addHandCard(select.card, 1)(handCards).state\n          setHandCards(ps)\n          break\n        }\n      }\n      pushHistory()\n      setIdle()\n\n    }\n  }\n\n  const onDropToGoal = (gid: number, gpos: number) => {\n    if (state.kind === 'select') {\n      const select = state.select\n      switch (select.kind) {\n        case 'premise': {\n          const [ps, gs] = moveFromTo(\n            premises, onIndex(select.pid, deleteCardAt(select.ppos)), \n            goals, card => onIndex(gid, onGoalJson(insertCardTo(card, gpos)))\n          )\n          setPremises(ps)\n          setGoals(gs)\n          break\n        } \n        case 'hand': {\n          const [hcs, gs] = moveFromTo(\n            handCards, getAHandCard(select.hpos), \n            goals, card => onIndex(gid, onGoalJson(insertCardTo(card, gpos)))\n          )\n          setHandCards(hcs)\n          setGoals(gs)\n          break\n        }\n        case 'goal': {\n          const gs = moveWithin(\n            goals, \n            onIndex(select.gid, onGoalJson(deleteCardAt(select.gpos))), \n            card => onIndex(gid, onGoalJson(insertCardTo(card, gpos)))\n          )\n          setGoals(gs)\n          break\n        }\n        case 'all': {\n          const gs = onIndex(gid, onGoalJson(insertCardTo(select.card, gpos)))(goals).state\n          setGoals(gs)\n          break\n        }\n      }\n      pushHistory()\n      setIdle()\n    }\n  }\n\n  const onDropToAllCards = () => {\n    if (state.kind === 'select') {\n      const select = state.select\n      switch (select.kind) {\n        case 'premise': {\n          const ps = onIndex(select.pid, deleteCardAt(select.ppos))(premises).state\n          setPremises(ps)\n          break\n        } \n        case 'hand': {\n          const hcs = deleteHandCard(select.hpos)(handCards).state\n          setHandCards(hcs)\n          break\n        }\n        case 'goal': {\n          const gs = onIndex(select.gid, onGoalJson(deleteCardAt(select.gpos)))(goals).state\n          setGoals(gs)\n          break\n        }\n        case 'all': {\n          break\n        }\n      }\n      pushHistory()\n      setIdle()\n    }\n  }\n\n  // misc actions\n  const toggleDrawer = (open: boolean) => (\n    event: React.KeyboardEvent | React.MouseEvent,\n  ) => {\n    if (\n      event.type === 'keydown' &&\n      ((event as React.KeyboardEvent).key === 'Tab' ||\n        (event as React.KeyboardEvent).key === 'Shift')\n    ) {\n      return\n    }\n    setShowDrawer(open)\n  } \n\n  const toggleConfirm = () => {\n    if (logins.user === undefined) {\n      alert(\"You need to login first!\")\n      logins.onLogin()\n    } else if (goals.length > 0 \n      && goals.map(g => getExprFromJson(g)).every(expr => parsePremiseSafe(expr) !== undefined)\n      && handCards.length > 0) {\n        setOnConfirm(true)\n    } else {\n      alert(\"This is not a valid level!\")\n    }\n  }\n\n  // post to server\n  const postJsonToServer = () => {\n    const data = {\n      user: logins.user,\n      level: evictJson() \n    }\n    setOnSubmit(true)\n    Axios.post(Paths.submitLevelJson, data)\n      .then(() => alert(\"Submission successful!\"))\n      .catch(err => alert(err))\n      .finally(() => {\n        setOnSubmit(false)\n        setOnConfirm(false)\n      })\n  }\n\n  // rendering\n\n  const renderAppBar = () => <AppBar position=\"static\">\n    <Toolbar style={{ backgroundColor: '#F2994A'}}>\n      <Typography variant=\"h6\" className={classes.title}>\n        {title}\n        <Tooltip title=\"Edit level name and description\" arrow>\n          <IconButton onClick={() => setChangeDesc(true)}>\n            <EditIcon/>\n          </IconButton>\n        </Tooltip>\n      </Typography>\n      <IconButton \n        edge=\"start\" \n        className={classes.menuButton} \n        color=\"inherit\" \n        aria-label=\"menu\"\n        onClick={toggleDrawer(true)}\n      >\n        <MenuIcon />\n      </IconButton>\n      <Drawer anchor=\"right\" open={isShowDrawer} onClose={toggleDrawer(false)}>\n        {renderDrawerContent()}\n      </Drawer>\n    </Toolbar>\n  </AppBar>\n\n  const renderDrawerContent = (): JSX.Element => {\n    const menu = <div>\n      <List>\n        <LinkContainer to='/'>\n          <ListItem button key=\"menu\" onClick={() => {}}>\n            <ListItemText primary=\"Back to Main Menu\"/>\n          </ListItem>\n        </LinkContainer>\n      </List>\n    </div>\n    return menu\n  }\n\n  const renderPremise = (i: number) => <EditorPremise \n    category={{ kind: 'premise', index: i }} \n    scale={1} \n    onLock={() => setLockPremise(i)}\n    onSelect={ppos => setSelect({ kind: 'premise', pid: i, ppos: ppos })}\n    onDrop={ppos => onDropToPremise(i, ppos)}\n  />\n\n  const renderPremises = () => premises.map((_, i) => renderPremise(i))\n\n  const renderHand = () => <EditorHand\n    onPick={hpos => setSelect({ kind: 'hand', hpos: hpos})}\n    onClickOnTag={setOpenHandCardEditor}\n    onDrop={onDropToHand}\n  />\n\n  const renderModifyCardCount = () => \n    <EditorModifyCardCountDialogue\n      hpos={onModifyCardPos}\n      onSubmit={c => {\n        setHandCardCount(onModifyCardPos, c)\n      }}\n    />  \n\n  const renderGoal = () => <GridListTile>\n    <EditorGoal\n      isSuccessful={isSuccess}\n      onSelect={(gid, gpos) => setSelect({ kind: 'goal', gid: gid, gpos: gpos})}\n      onDrop={onDropToGoal}\n      onChange={gid => setState({ kind: 'changeGoal', gid: gid, newGoal: goals[gid] })}\n    />\n  </GridListTile>\n\n  const renderGoals = () => {\n    return <div>\n      {renderGoal()}\n      <div style={{ width: '40', textAlign: 'left', marginBottom: '20px', marginRight: '70px', position: 'absolute', right: '0'}}>\n        <Tooltip title=\"Add a new goal\" aria-label=\"add\" arrow>\n          <Fab style={{ left: 40, backgroundColor: '#F2994A', color:'#fff' }} onClick={setAddGoal}>\n            <AddIcon style={{ fontSize: '30' }}/>\n          </Fab>\n        </Tooltip>\n        <Tooltip title=\"Delete the last goal\" aria-label=\"del\" arrow>\n          <Fab \n            style={{ left: 40, backgroundColor: '#A359A3', color:'#fff', margin: '20px' }} \n            onClick={() => setRemoveGoal(goals.length - 1)}\n          >\n            <RemoveIcon style={{ fontSize: '30' }}/>\n          </Fab>\n        </Tooltip>\n      </div>\n      <ChangeGoalDialogue\n        updateGoal={g => setState({kind: 'changeGoal', gid: state.kind == 'changeGoal' ? state.gid : -1, newGoal: g })}\n        confirmGoal={() => {\n          if (state.kind == 'changeGoal') {\n            setModifyGoal(state.gid, state.newGoal)\n          }\n        }}\n        deleteGoal={gid => setRemoveGoal(gid)}\n      />\n    </div>\n  }\n\n  const renderTruthTable = () => (\n    <Dialog \n      open={isShowTruthTable} \n      onClose={() => setShowTruthTable(false)} \n      title=\"Truth Table\"\n    >\n      <TruthTable premises={premises}/>\n    </Dialog>\n  )\n\n  const renderAllCardsList = () => <EditorAllCards\n    onSelect={c => setSelect({ kind: 'all', card: c })}\n    onDrop={onDropToAllCards}\n  />\n\n  const renderConfirmation = () => \n    <Dialog open={onConfirm} onClose={() => setOnConfirm(false)}>\n      <DialogTitle>Submit</DialogTitle>\n      <DialogContent>\n        Are you sure you want to submit your level?\n        <GridList cols={1} style={{ width: '300px', height: '200px', marginTop: '10px'}}>\n          <GridListTile>\n            <TextField\n              id=\"outlined-read-only-input\"\n              label=\"Level Setup in JSON\"\n              multiline\n              defaultValue={JSON.stringify(evictJson())}\n              InputProps={{\n                readOnly: true,\n              }}\n              style={{ marginTop: '20px'}}\n              variant=\"outlined\"\n              fullWidth\n            />\n          </GridListTile>\n        </GridList>\n      </DialogContent>\n      <Divider/>\n      <div>{ onSubmit ? <LinearProgress /> : undefined }</div>\n      <DialogActions>\n        <MButton onClick={postJsonToServer}>Confirm</MButton>\n      </DialogActions>\n    </Dialog>\n\n  const renderFooter = () => <BottomNavigation\n    value={0}\n    showLabels\n    className={classes.root}\n    style={{\n      width: '100%',\n      position: 'sticky',\n      bottom: 0,\n    }}\n  > \n    <MButton startIcon={<UndoIcon/>} onClick={undoHistory}>UNDO ONE STEP</MButton>  \n    <MButton startIcon={<EditIcon/>} onClick={() => setChangeDesc(true)}>EDIT DESCRIPTION</MButton>  \n    <MButton startIcon={<FeedbackIcon/>} onClick={() => setShowTruthTable(true)}>SHOW TRUTH TABLE</MButton>  \n    <MButton startIcon={<PublishIcon/>} onClick={toggleConfirm}>SUBMIT</MButton>  \n  </BottomNavigation>\n\n  return (\n    <EditorContext.Provider value={{\n      state: state,\n      premises: premises,\n      handCards: handCards,\n      goals: goals,\n      lockedPremises: lockedPremises,\n      goalTrees: goalTrees,\n      setIdle: setIdle\n    }}>\n      <div>\n        {renderAppBar()}\n        {renderPremises()}\n        <Divider style={{ margin: '10px' }}/>\n        <Grid container>\n          <Grid item xs={4}>\n            <GridList cols={1} style={{ flexWrap: 'nowrap', transform: 'translateZ(0)', height: '220px'}}>\n              {renderGoals()}\n            </GridList>\n          </Grid>\n          <Divider orientation=\"vertical\" flexItem />\n          <Grid item xs={4}>\n            <GridList cols={1} style={{ flexWrap: 'nowrap', transform: 'translateZ(0)', height: '220px'}}>\n              {renderHand()}\n            </GridList>\n          </Grid>\n          <Divider orientation=\"vertical\" flexItem />\n          <Grid item alignContent='center'>\n            {renderAllCardsList()}\n          </Grid>\n        </Grid>\n        {renderFooter()}\n        {renderConfirmation()}\n        {renderModifyCardCount()}\n        {renderTruthTable()}\n        <DescEditorDialogue\n          open={isChangeDesc}\n          title={title}\n          desc={desc}\n          onSubmit={(title, desc) => {\n            setTitle(title)\n            setDesc(desc)\n          }}\n          onCancel={() => setChangeDesc(false)}\n        />\n      </div>\n    </EditorContext.Provider>\n  )\n  \n}"]},"metadata":{},"sourceType":"module"}