{"ast":null,"code":"var _jsxFileName = \"/Users/johnny/IC/Computing/DRP/drp48/src/components/game/LevelBoard.tsx\";\nimport React, { useState, useEffect } from 'react';\nimport { PremiseComponent } from './Premise';\nimport { HandCardAreaComponent } from './HandCard';\nimport { DndProvider } from 'react-dnd';\nimport { HTML5Backend } from 'react-dnd-html5-backend';\nimport Axios from 'axios';\nimport { Paths } from '../../routesPaths';\nimport { doActionToView, getGoalStates, fixInfinityNumber } from '../../game/views';\nimport { Table, Button } from 'react-bootstrap';\nimport Context from './gameContext';\nimport { playCardsToAction, discardAction } from '../../game/actions';\nimport { variable } from '../../server/gameApp/logicResolver/bools';\nimport { GoalsComponent } from './Goals';\nimport { useParams } from 'react-router';\nimport './Board.css';\n\nfunction initialGameView(playerVar) {\n  return {\n    playerVar: playerVar,\n    handCardWithCount: [],\n    discardPile: [],\n    premises: [],\n    deckCount: 0,\n    goals: [{\n      kind: 'prove',\n      expr: [playerVar],\n      boolTree: variable(playerVar)\n    }]\n  };\n}\n\nconst playAs = \"A\"; // Game board\n\nconst LevelBoardComponent = () => {\n  // read router parameter\n  const params = useParams();\n  const levelID = Number(params.levelID);\n  console.log(levelID, params.levelID); // Actions been taken in this round\n\n  const [actions, setActions] = useState([]); // Which hand card is selected at now \n  // -1 if no card is selected\n\n  const [handSelected, setHandSelected] = useState(-1); // History of views in this round\n\n  const [historyViews, setHV] = useState([initialGameView(\"A\")]);\n  const view = historyViews[historyViews.length - 1];\n  const [goalStates, setGoalStates] = useState(view.goals.map(_ => false)); // Refresh from server at the very beginning\n\n  useEffect(() => {\n    fetchInitLevelFromServer();\n  }, []);\n\n  const unselectHandCard = () => setHandSelected(-1);\n\n  const setHistoryViews = newViews => {\n    setHV(newViews);\n    setGoalStates(getGoalStates(newViews[newViews.length - 1]));\n  };\n\n  const pushAction = action => {\n    setActions(actions.concat(action));\n  };\n\n  const popAction = () => {\n    setActions(actions.slice(0, actions.length - 1));\n  };\n\n  const pushHistoryView = view => {\n    setHistoryViews(historyViews.concat(view));\n  };\n\n  const popHistoryView = () => {\n    setHistoryViews(historyViews.slice(0, historyViews.length - 1));\n  };\n\n  const doAction = action => {\n    const newView = doActionToView(view, action);\n    pushAction(action);\n    pushHistoryView(newView);\n    unselectHandCard();\n  };\n\n  const undoAction = () => {\n    if (actions.length > 0) {\n      popAction();\n      popHistoryView();\n    }\n  };\n\n  const clearHistory = () => {\n    while (actions.length > 0) {\n      undoAction();\n    }\n  };\n\n  const fetchInitLevelFromServer = () => {\n    const config = {\n      params: {\n        levelID: levelID\n      }\n    };\n    Axios.get(Paths.levelRequest, config).then(res => {\n      console.log(res.data);\n      setHistoryViews([fixInfinityNumber(res.data.view)]);\n    });\n  };\n\n  const menuAction = () => {\n    if (actions.length > 0) {\n      fetchInitLevelFromServer();\n    }\n\n    window.location.href = '../../levelPage/Aristotes/1/16';\n  };\n\n  const submitAnswerToServer = () => {\n    const config = {\n      params: {\n        isSuccess: goalStates.reduce((a, b) => a && b)\n      }\n    };\n    Axios.get(Paths.levelSubmit, config).then(res => {\n      alert(res.data.msg);\n    });\n  };\n\n  const renderPremises = () => {\n    const result = [];\n\n    for (let i = 0; i < view.premises.length; i++) {\n      const [premise, isLocked] = view.premises[i];\n      result.push( /*#__PURE__*/React.createElement(PremiseComponent, {\n        cards: premise,\n        scale: 1,\n        isLocked: isLocked,\n        premiseIndex: i,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 144,\n          columnNumber: 9\n        }\n      }));\n    }\n\n    return /*#__PURE__*/React.createElement(Table, {\n      striped: true,\n      bordered: true,\n      hover: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 153,\n        columnNumber: 7\n      }\n    }, result.map(it => /*#__PURE__*/React.createElement(\"tr\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 154,\n        columnNumber: 27\n      }\n    }, it)));\n  };\n\n  const renderHandCardArea = () => {\n    return /*#__PURE__*/React.createElement(HandCardAreaComponent, {\n      playerVar: playAs,\n      cards: view.handCardWithCount,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 160,\n        columnNumber: 12\n      }\n    });\n  };\n\n  const renderGoals = () => {\n    return /*#__PURE__*/React.createElement(GoalsComponent, {\n      goals: view.goals,\n      isSuccessful: goalStates,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 167,\n        columnNumber: 12\n      }\n    });\n  };\n\n  const renderButtonPanel = () => {\n    const buttonView = /*#__PURE__*/React.createElement(Button, {\n      className: \"prettyButton\",\n      onClick: () => alert(JSON.stringify(view)),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 171,\n        columnNumber: 24\n      }\n    }, \"view\");\n    const buttonRef = /*#__PURE__*/React.createElement(Button, {\n      className: \"prettyButton\",\n      onClick: fetchInitLevelFromServer,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 172,\n        columnNumber: 23\n      }\n    }, \"refresh\");\n    const buttonSubmit = /*#__PURE__*/React.createElement(Button, {\n      className: \"prettyButton\",\n      onClick: submitAnswerToServer,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 173,\n        columnNumber: 26\n      }\n    }, \"submit\");\n    const buttonUndo = /*#__PURE__*/React.createElement(Button, {\n      className: \"prettyButton\",\n      onClick: undoAction,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 174,\n        columnNumber: 24\n      }\n    }, \"Undo\");\n    const buttonMenu = /*#__PURE__*/React.createElement(Button, {\n      className: \"prettyButton\",\n      onClick: menuAction,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 175,\n        columnNumber: 24\n      }\n    }, \"Back to menu\");\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 176,\n        columnNumber: 12\n      }\n    }, [buttonRef, buttonSubmit, buttonUndo, buttonMenu]);\n  };\n\n  return /*#__PURE__*/React.createElement(DndProvider, {\n    backend: HTML5Backend,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 180,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Context.Provider, {\n    value: {\n      playerVar: playAs,\n      handSelected: handSelected,\n      handCardSelected: handSelected >= 0 ? view.handCardWithCount[handSelected][0] : undefined,\n      unselectHand: unselectHandCard,\n      pickHandCardCallback: handIndex => {\n        setHandSelected(handIndex);\n      },\n      moveHandCardToPremise: (premiseId, inPremiseIndex) => {\n        doAction(playCardsToAction(playAs, handSelected, [premiseId, inPremiseIndex]));\n      },\n      discardPickedHandCard: () => {\n        doAction(discardAction(playAs, handSelected));\n      }\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 181,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"status\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 196,\n      columnNumber: 9\n    }\n  }), renderPremises(), /*#__PURE__*/React.createElement(Table, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 198,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"tbody\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 199,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"tr\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 200,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"td\", {\n    style: {\n      width: \"50rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 201,\n      columnNumber: 15\n    }\n  }, renderHandCardArea()), /*#__PURE__*/React.createElement(\"td\", {\n    style: {\n      marginRight: \"30px\",\n      marginLeft: \"auto\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 202,\n      columnNumber: 15\n    }\n  }, renderButtonPanel())))), renderGoals()));\n};\n\nexport { LevelBoardComponent };","map":{"version":3,"sources":["/Users/johnny/IC/Computing/DRP/drp48/src/components/game/LevelBoard.tsx"],"names":["React","useState","useEffect","PremiseComponent","HandCardAreaComponent","DndProvider","HTML5Backend","Axios","Paths","doActionToView","getGoalStates","fixInfinityNumber","Table","Button","Context","playCardsToAction","discardAction","variable","GoalsComponent","useParams","initialGameView","playerVar","handCardWithCount","discardPile","premises","deckCount","goals","kind","expr","boolTree","playAs","LevelBoardComponent","params","levelID","Number","console","log","actions","setActions","handSelected","setHandSelected","historyViews","setHV","view","length","goalStates","setGoalStates","map","_","fetchInitLevelFromServer","unselectHandCard","setHistoryViews","newViews","pushAction","action","concat","popAction","slice","pushHistoryView","popHistoryView","doAction","newView","undoAction","clearHistory","config","get","levelRequest","then","res","data","menuAction","window","location","href","submitAnswerToServer","isSuccess","reduce","a","b","levelSubmit","alert","msg","renderPremises","result","i","premise","isLocked","push","it","renderHandCardArea","renderGoals","renderButtonPanel","buttonView","JSON","stringify","buttonRef","buttonSubmit","buttonUndo","buttonMenu","handCardSelected","undefined","unselectHand","pickHandCardCallback","handIndex","moveHandCardToPremise","premiseId","inPremiseIndex","discardPickedHandCard","width","marginRight","marginLeft"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react'\nimport { PremiseComponent } from './Premise'\nimport { HandCardAreaComponent } from './HandCard'\nimport { Premise, GameView, GameAction, Card } from '../../types'\nimport { DndProvider } from 'react-dnd'\nimport { HTML5Backend } from 'react-dnd-html5-backend'\nimport { DiscardArea } from './DiscardArea'\nimport Axios, { AxiosRequestConfig } from 'axios'\nimport SocketIOClient from 'socket.io-client'\nimport { Paths, SocketEvents } from '../../routesPaths'\nimport { doActionToView, playHandCardTo, getGoalStates, fixInfinityNumber } from '../../game/views'\nimport { Table, Button } from 'react-bootstrap'\nimport Context from './gameContext'\nimport { playCardsToAction, discardAction } from '../../game/actions'\nimport { variable } from '../../server/gameApp/logicResolver/bools'\nimport { GoalsComponent } from './Goals'\nimport { useParams } from 'react-router'\n\nimport './Board.css'\n\ninterface LevelBoardParams {\n  levelID: string\n}\n\nfunction initialGameView(playerVar: string): GameView {\n  return { \n    playerVar: playerVar,\n    handCardWithCount: [],\n    discardPile: [],\n    premises: [],\n    deckCount: 0,\n    goals: [{ kind: 'prove', expr: [playerVar as Card], boolTree: variable(playerVar) }]\n  }\n}\n\nconst playAs: Card = \"A\"\n\n// Game board\nconst LevelBoardComponent = () => {\n  // read router parameter\n  const params = useParams<LevelBoardParams>()\n  const levelID = Number(params.levelID)\n\n  console.log(levelID, params.levelID);\n  \n\n  // Actions been taken in this round\n  const [actions, setActions] = useState([] as GameAction[])\n  // Which hand card is selected at now \n  // -1 if no card is selected\n  const [handSelected, setHandSelected] = useState(-1)\n  // History of views in this round\n  const [historyViews, setHV] = useState([initialGameView(\"A\")] as GameView[])\n\n  const view = historyViews[historyViews.length - 1]\n\n  const [goalStates, setGoalStates] = useState(view.goals.map(_ => false))\n\n  // Refresh from server at the very beginning\n  useEffect(() => {\n    fetchInitLevelFromServer()\n  }, [])\n\n  const unselectHandCard = () => setHandSelected(-1)\n\n  const setHistoryViews = (newViews: GameView[]) => {\n    setHV(newViews)\n    setGoalStates(getGoalStates(newViews[newViews.length - 1]))\n  }\n\n  const pushAction = (action: GameAction) => {\n    setActions(actions.concat(action))\n  }\n\n  const popAction = () => {\n    setActions(actions.slice(0, actions.length - 1))\n  }\n\n  const pushHistoryView = (view: GameView) => {\n    setHistoryViews(historyViews.concat(view))\n  }\n\n  const popHistoryView = () => {\n    setHistoryViews(historyViews.slice(0, historyViews.length - 1))\n  }\n\n  const doAction = (action: GameAction) => {\n    const newView = doActionToView(view, action)\n    pushAction(action)\n    pushHistoryView(newView)\n    unselectHandCard()\n  }\n\n  const undoAction = () => {\n    if (actions.length > 0) {\n      popAction()\n      popHistoryView()\n    }\n  }\n\n  const clearHistory = () => {\n    while (actions.length > 0) {\n      undoAction()\n    }\n  }\n\n  const fetchInitLevelFromServer = () => {\n    const config: AxiosRequestConfig = {\n      params: {\n        levelID: levelID,\n      }\n    }\n    Axios.get(Paths.levelRequest, config)\n      .then(res => {\n        console.log(res.data);\n        setHistoryViews([fixInfinityNumber(res.data.view as GameView)])\n      })\n  }\n\n  const menuAction = () => {\n    if (actions.length > 0) {\n      fetchInitLevelFromServer()\n    }\n    window.location.href='../../levelPage/Aristotes/1/16'\n  }\n\n  const submitAnswerToServer = () => {\n    const config: AxiosRequestConfig = {\n      params: {\n        isSuccess: goalStates.reduce((a, b) => a && b)\n      }\n    }\n    Axios.get(Paths.levelSubmit, config)\n      .then(res => {\n        alert(res.data.msg);\n      })\n  }\n\n  const renderPremises = (): JSX.Element => {\n    const result: JSX.Element[] = []\n    for (let i = 0; i < view.premises.length; i++) {\n      const [premise, isLocked] = view.premises[i]\n      result.push(\n        <PremiseComponent \n          cards={premise} \n          scale={1}\n          isLocked={isLocked}\n          premiseIndex={i} \n        />\n      )\n    }\n    return (\n      <Table striped bordered hover>\n        {result.map(it => <tr>{it}</tr>)}\n      </Table>\n    )\n  }\n\n  const renderHandCardArea = (): JSX.Element => {\n    return <HandCardAreaComponent\n      playerVar={playAs}\n      cards={view.handCardWithCount}\n    />\n  }\n\n  const renderGoals = (): JSX.Element => {\n    return <GoalsComponent goals={view.goals} isSuccessful={goalStates} ></GoalsComponent>\n  }\n\n  const renderButtonPanel = (): JSX.Element => {\n    const buttonView = <Button className=\"prettyButton\" onClick={() => alert(JSON.stringify(view))}>view</Button>\n    const buttonRef = <Button className=\"prettyButton\" onClick={fetchInitLevelFromServer}>refresh</Button>\n    const buttonSubmit = <Button className=\"prettyButton\" onClick={submitAnswerToServer}>submit</Button>\n    const buttonUndo = <Button className=\"prettyButton\" onClick={undoAction}>Undo</Button>\n    const buttonMenu = <Button className=\"prettyButton\" onClick={menuAction}>Back to menu</Button>\n    return <div>{[buttonRef, buttonSubmit, buttonUndo, buttonMenu]}</div>\n  }\n\n  return(\n    <DndProvider backend={HTML5Backend}>\n      <Context.Provider value={{\n          playerVar: playAs,\n          handSelected: handSelected,\n          handCardSelected: handSelected >= 0 ? view.handCardWithCount[handSelected][0] : undefined,\n          unselectHand: unselectHandCard,\n          pickHandCardCallback: (handIndex: number) => {\n            setHandSelected(handIndex)\n          },\n          moveHandCardToPremise: (premiseId: number, inPremiseIndex: number) => {\n            doAction(playCardsToAction(playAs, handSelected, [premiseId, inPremiseIndex]))\n          },\n          discardPickedHandCard: () => {\n            doAction(discardAction(playAs, handSelected))\n          }\n      }}>\n        <div className=\"status\"></div>\n          {renderPremises()}\n        <Table >\n          <tbody>\n            <tr>\n              <td style={{ width: \"50rem\"}}>{renderHandCardArea()}</td>\n              <td style={{ marginRight: \"30px\", marginLeft: \"auto\" }}>{renderButtonPanel()}</td>\n            </tr>\n          </tbody>\n        </Table>\n\n        {renderGoals()}\n      </Context.Provider>\n    </DndProvider>\n  )\n\n}\n\nexport { LevelBoardComponent }"]},"metadata":{},"sourceType":"module"}