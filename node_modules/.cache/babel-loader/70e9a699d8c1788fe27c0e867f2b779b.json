{"ast":null,"code":"var _jsxFileName = \"/Users/johnny/IC/Computing/DRP/drp48/src/components/game/LevelBoard.tsx\";\nimport React, { useState, useEffect } from 'react';\nimport { PremiseComponent } from './Premise';\nimport { HandCardAreaComponent } from './HandCard';\nimport { DndProvider } from 'react-dnd';\nimport { HTML5Backend } from 'react-dnd-html5-backend';\nimport Axios from 'axios';\nimport { Paths } from '../../routesPaths';\nimport { doActionToView, getGoalStates, fixInfinityNumber } from '../../game/views';\nimport { Table, Button, Form } from 'react-bootstrap';\nimport Context from './gameContext';\nimport { playCardsToAction, discardAction } from '../../game/actions';\nimport { GoalsComponent } from './Goals';\nimport { LinkContainer } from 'react-router-bootstrap';\nimport { AppBar, Toolbar, Typography, Button as MButton, IconButton, Container, Grid, Drawer, List, Divider, ListItem, ListItemText, BottomNavigation, Dialog, Slide, DialogTitle, DialogContent, DialogContentText, DialogActions } from '@material-ui/core';\nimport MenuIcon from '@material-ui/icons/Menu';\nimport UndoIcon from '@material-ui/icons/Undo';\nimport FeedbackIcon from '@material-ui/icons/Feedback';\nimport NavigateNextIcon from '@material-ui/icons/NavigateNext';\nimport './Board.css';\nimport { useStyles } from '../appbar';\nimport { TruthTable } from './Truthtable';\nconst Transition = React.forwardRef(function Transition(props, ref) {\n  return /*#__PURE__*/React.createElement(Slide, Object.assign({\n    direction: \"up\",\n    ref: ref\n  }, props, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 53,\n      columnNumber: 10\n    }\n  }));\n});\nconst playAs = \"A\";\n\n// Game board\nconst LevelBoardComponent = ({\n  title,\n  description,\n  initView,\n  nextUrl,\n  backUrl\n}) => {\n  // Actions been taken in this round\n  const [actions, setActions] = useState([]); // Which hand card is selected at now \n  // -1 if no card is selected\n\n  const [handSelected, setHandSelected] = useState(-1); // History of views in this round\n\n  const [historyViews, setHV] = useState([fixInfinityNumber(initView)]); // Whether to show the right hand side drawer\n\n  const [isShowDrawer, setShowDrawer] = useState(false);\n  const [isShownSuccessDialogue, setShownSuccessDialogue] = useState(false);\n  const [isShowTruthTable, setShowTruthTable] = useState(false);\n  const [bottomNavIndex, setBottomNavIndex] = useState(0); // which description to display, if descIndex = description.length, no display\n\n  const [descIndex, setDescIndex] = useState(description.length);\n  const view = historyViews[historyViews.length - 1];\n  const [goalStates, setGoalStates] = useState(view.goals.map(_ => false));\n  const classes = useStyles();\n  const [allVars, setAllVars] = useState([]); // Refresh from server at the very beginning\n\n  useEffect(() => {\n    setDescIndex(0);\n    setShownSuccessDialogue(false);\n    setHistoryViews([initView]);\n  }, [initView]); // Recalculate variables  \n\n  useEffect(() => {\n    const cards = new Set();\n\n    const addVars = p => p.filter(it => [\"A\", \"B\", \"C\", \"D\"].includes(it)).forEach(c => cards.add(c));\n\n    view.premises.forEach(([p, _]) => addVars(p));\n    addVars(view.handCardWithCount.map(([c, _]) => c));\n    setAllVars(Array.from(cards));\n  }, [historyViews]);\n\n  const isSuccess = () => goalStates.reduce((a, b) => a && b);\n\n  const unselectHandCard = () => setHandSelected(-1);\n\n  const setHistoryViews = newViews => {\n    setHV(newViews);\n    setGoalStates(getGoalStates(newViews[newViews.length - 1]));\n  };\n\n  const pushAction = action => {\n    setActions(actions.concat(action));\n  };\n\n  const popAction = () => {\n    setActions(actions.slice(0, actions.length - 1));\n  };\n\n  const pushHistoryView = view => {\n    setHistoryViews(historyViews.concat(view));\n  };\n\n  const popHistoryView = () => {\n    setHistoryViews(historyViews.slice(0, historyViews.length - 1));\n  };\n\n  const doAction = async action => {\n    const newView = doActionToView(view, action);\n    pushAction(action);\n    pushHistoryView(newView);\n    unselectHandCard();\n  };\n\n  const undoAction = async () => {\n    if (actions.length > 0) {\n      popAction();\n      popHistoryView();\n    }\n  };\n\n  const setNextDesc = () => {\n    if (descIndex == description.length) {\n      setDescIndex(0);\n    } else {\n      setDescIndex(descIndex + 1);\n    }\n  };\n\n  const toggleDrawer = open => event => {\n    if (event.type === 'keydown' && (event.key === 'Tab' || event.key === 'Shift')) {\n      return;\n    }\n\n    setShowDrawer(open);\n  };\n\n  const submitAnswerToServer = () => {\n    const config = {\n      params: {\n        isSuccess: isSuccess()\n      }\n    };\n    Axios.get(Paths.levelSubmit, config).then(res => {\n      alert(res.data.msg);\n    });\n  };\n\n  const renderSuccessDialogue = /*#__PURE__*/React.createElement(Dialog, {\n    open: !isShownSuccessDialogue && isSuccess(),\n    TransitionComponent: Transition,\n    keepMounted: true,\n    onClose: () => setShownSuccessDialogue(true),\n    \"aria-labelledby\": \"alert-dialog-slide-title\",\n    \"aria-describedby\": \"alert-dialog-slide-description\",\n    style: {\n      color: 'green'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 189,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(DialogTitle, {\n    id: \"alert-dialog-slide-title\",\n    style: {\n      color: 'green'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 198,\n      columnNumber: 7\n    }\n  }, \"LEVEL PASSED!\"), /*#__PURE__*/React.createElement(DialogContent, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 199,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(DialogContentText, {\n    id: \"alert-dialog-slide-description\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 200,\n      columnNumber: 9\n    }\n  }, \"You have completed this challenge!\")), /*#__PURE__*/React.createElement(DialogActions, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 204,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(MButton, {\n    onClick: () => setShownSuccessDialogue(true),\n    color: \"secondary\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 205,\n      columnNumber: 9\n    }\n  }, \"CLOSE\"), nextUrl !== \"\" ? /*#__PURE__*/React.createElement(LinkContainer, {\n    to: nextUrl,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 208,\n      columnNumber: 27\n    }\n  }, /*#__PURE__*/React.createElement(MButton, {\n    color: \"primary\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 209,\n      columnNumber: 11\n    }\n  }, \"NEXT LEVEL\")) : undefined));\n\n  const renderPremises = () => {\n    const result = [];\n\n    for (let i = 0; i < 4; i++) {\n      var _view$premises$i;\n\n      const [premise, isLocked] = (_view$premises$i = view.premises[i]) !== null && _view$premises$i !== void 0 ? _view$premises$i : [[], true];\n      result.push( /*#__PURE__*/React.createElement(PremiseComponent, {\n        cards: premise,\n        scale: 1,\n        isLocked: isLocked,\n        isProofPremise: true,\n        premiseIndex: i,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 221,\n          columnNumber: 9\n        }\n      }));\n    }\n\n    if (view.premises.length == 1) {\n      [result[0], result[1]] = [result[1], result[0]];\n    } else if (view.premises.length == 2) {\n      [result[1], result[2], result[0]] = [result[0], result[1], result[2]];\n    }\n\n    return /*#__PURE__*/React.createElement(Table, {\n      striped: true,\n      hover: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 236,\n        columnNumber: 7\n      }\n    }, result.map(it => /*#__PURE__*/React.createElement(\"tr\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 237,\n        columnNumber: 27\n      }\n    }, it)));\n  };\n\n  const renderHandCardArea = () => {\n    return /*#__PURE__*/React.createElement(HandCardAreaComponent, {\n      playerVar: playAs,\n      cards: view.handCardWithCount,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 243,\n        columnNumber: 12\n      }\n    });\n  };\n\n  const renderGoals = () => {\n    return /*#__PURE__*/React.createElement(GoalsComponent, {\n      goals: view.goals,\n      isSuccessful: goalStates,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 250,\n        columnNumber: 12\n      }\n    });\n  };\n\n  const renderDrawerContent = () => {\n    const menu = /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 254,\n        columnNumber: 18\n      }\n    }, /*#__PURE__*/React.createElement(List, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 255,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(ListItem, {\n      button: true,\n      key: \"sub\",\n      onClick: submitAnswerToServer,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 256,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(ListItemText, {\n      primary: \"Submit\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 257,\n        columnNumber: 11\n      }\n    }))), /*#__PURE__*/React.createElement(Divider, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 260,\n        columnNumber: 7\n      }\n    }), /*#__PURE__*/React.createElement(List, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 261,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(LinkContainer, {\n      to: backUrl,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 262,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(ListItem, {\n      button: true,\n      key: \"levelPage\",\n      onClick: () => {},\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 263,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(ListItemText, {\n      primary: \"Back to Level Page\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 264,\n        columnNumber: 13\n      }\n    }))), /*#__PURE__*/React.createElement(LinkContainer, {\n      to: \"/\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 267,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(ListItem, {\n      button: true,\n      key: \"menu\",\n      onClick: () => {},\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 268,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(ListItemText, {\n      primary: \"Back to Main Menu\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 269,\n        columnNumber: 13\n      }\n    })))));\n    return menu;\n  };\n\n  return /*#__PURE__*/React.createElement(DndProvider, {\n    backend: HTML5Backend,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 278,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Context.Provider, {\n    value: {\n      playerVar: playAs,\n      handSelected: handSelected,\n      handCardSelected: handSelected >= 0 ? view.handCardWithCount[handSelected][0] : undefined,\n      unselectHand: unselectHandCard,\n      pickHandCardCallback: handIndex => {\n        setHandSelected(handIndex);\n      },\n      moveHandCardToPremise: (premiseId, inPremiseIndex) => {\n        doAction(playCardsToAction(playAs, handSelected, [premiseId, inPremiseIndex]));\n      },\n      discardPickedHandCard: () => {\n        doAction(discardAction(playAs, handSelected));\n      }\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 279,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(AppBar, {\n    position: \"static\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 294,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Toolbar, {\n    style: {\n      backgroundColor: '#F2994A'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 295,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Typography, {\n    variant: \"h6\",\n    className: classes.title,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 296,\n      columnNumber: 13\n    }\n  }, title), /*#__PURE__*/React.createElement(IconButton, {\n    edge: \"start\",\n    className: classes.menuButton,\n    color: \"inherit\",\n    \"aria-label\": \"menu\",\n    onClick: toggleDrawer(true),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 299,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(MenuIcon, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 306,\n      columnNumber: 15\n    }\n  })), /*#__PURE__*/React.createElement(Drawer, {\n    anchor: \"right\",\n    open: isShowDrawer,\n    onClose: toggleDrawer(false),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 308,\n      columnNumber: 13\n    }\n  }, renderDrawerContent()))), /*#__PURE__*/React.createElement(Container, {\n    maxWidth: \"xl\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 313,\n      columnNumber: 9\n    }\n  }, renderPremises()), /*#__PURE__*/React.createElement(Divider, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 316,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(Container, {\n    maxWidth: \"xl\",\n    style: {\n      marginTop: \"20px\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 318,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    container: true,\n    spacing: 0,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 319,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 6,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 320,\n      columnNumber: 13\n    }\n  }, renderHandCardArea()), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 6,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 323,\n      columnNumber: 13\n    }\n  }, renderGoals()))), /*#__PURE__*/React.createElement(Divider, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 328,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(BottomNavigation, {\n    value: bottomNavIndex,\n    showLabels: true,\n    className: classes.root,\n    style: {\n      width: '100%',\n      position: 'sticky',\n      bottom: 0\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 330,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(MButton, {\n    startIcon: /*#__PURE__*/React.createElement(UndoIcon, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 340,\n        columnNumber: 31\n      }\n    }),\n    onClick: undoAction,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 340,\n      columnNumber: 11\n    }\n  }, \"UNDO ONE STEP\"), /*#__PURE__*/React.createElement(MButton, {\n    disabled: description.length == 0,\n    startIcon: /*#__PURE__*/React.createElement(FeedbackIcon, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 341,\n        columnNumber: 67\n      }\n    }),\n    onClick: setNextDesc,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 341,\n      columnNumber: 11\n    }\n  }, \"SHOW HINTS\"), /*#__PURE__*/React.createElement(MButton, {\n    startIcon: /*#__PURE__*/React.createElement(FeedbackIcon, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 342,\n        columnNumber: 31\n      }\n    }),\n    onClick: () => setShowTruthTable(true),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 342,\n      columnNumber: 11\n    }\n  }, \"SHOW TRUTH TABLE\"), /*#__PURE__*/React.createElement(LinkContainer, {\n    to: nextUrl,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 343,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(MButton, {\n    disabled: nextUrl === \"\" || !isSuccess(),\n    startIcon: /*#__PURE__*/React.createElement(NavigateNextIcon, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 344,\n        columnNumber: 76\n      }\n    }),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 344,\n      columnNumber: 13\n    }\n  }, \"NEXT LEVEL\"))), /*#__PURE__*/React.createElement(Dialog, {\n    open: descIndex != description.length,\n    onClose: () => setDescIndex(description.length),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 348,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(DialogTitle, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 349,\n      columnNumber: 11\n    }\n  }, \"Hint\"), /*#__PURE__*/React.createElement(DialogContent, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 350,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Form, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 351,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Form.Label, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 352,\n      columnNumber: 15\n    }\n  }, description[descIndex]))), /*#__PURE__*/React.createElement(DialogActions, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 355,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    onClick: setNextDesc,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 356,\n      columnNumber: 13\n    }\n  }, \"\\u2192\"))), /*#__PURE__*/React.createElement(Dialog, {\n    open: isShowTruthTable,\n    onClose: () => setShowTruthTable(false),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 360,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(DialogTitle, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 361,\n      columnNumber: 11\n    }\n  }, \"Truth Table\"), /*#__PURE__*/React.createElement(DialogContent, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 362,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(TruthTable, {\n    premises: view.premises.map(([p, _]) => p),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 363,\n      columnNumber: 14\n    }\n  }))), renderSuccessDialogue));\n};\n\nexport { LevelBoardComponent };","map":{"version":3,"sources":["/Users/johnny/IC/Computing/DRP/drp48/src/components/game/LevelBoard.tsx"],"names":["React","useState","useEffect","PremiseComponent","HandCardAreaComponent","DndProvider","HTML5Backend","Axios","Paths","doActionToView","getGoalStates","fixInfinityNumber","Table","Button","Form","Context","playCardsToAction","discardAction","GoalsComponent","LinkContainer","AppBar","Toolbar","Typography","MButton","IconButton","Container","Grid","Drawer","List","Divider","ListItem","ListItemText","BottomNavigation","Dialog","Slide","DialogTitle","DialogContent","DialogContentText","DialogActions","MenuIcon","UndoIcon","FeedbackIcon","NavigateNextIcon","useStyles","TruthTable","Transition","forwardRef","props","ref","playAs","LevelBoardComponent","title","description","initView","nextUrl","backUrl","actions","setActions","handSelected","setHandSelected","historyViews","setHV","isShowDrawer","setShowDrawer","isShownSuccessDialogue","setShownSuccessDialogue","isShowTruthTable","setShowTruthTable","bottomNavIndex","setBottomNavIndex","descIndex","setDescIndex","length","view","goalStates","setGoalStates","goals","map","_","classes","allVars","setAllVars","setHistoryViews","cards","Set","addVars","p","filter","it","includes","forEach","c","add","premises","handCardWithCount","Array","from","isSuccess","reduce","a","b","unselectHandCard","newViews","pushAction","action","concat","popAction","slice","pushHistoryView","popHistoryView","doAction","newView","undoAction","setNextDesc","toggleDrawer","open","event","type","key","submitAnswerToServer","config","params","get","levelSubmit","then","res","alert","data","msg","renderSuccessDialogue","color","undefined","renderPremises","result","i","premise","isLocked","push","renderHandCardArea","renderGoals","renderDrawerContent","menu","playerVar","handCardSelected","unselectHand","pickHandCardCallback","handIndex","moveHandCardToPremise","premiseId","inPremiseIndex","discardPickedHandCard","backgroundColor","menuButton","marginTop","root","width","position","bottom"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useRef } from 'react'\nimport { PremiseComponent } from './Premise'\nimport { HandCardAreaComponent } from './HandCard'\nimport { GameView, GameAction, Card, Premise } from '../../types'\nimport { DndProvider } from 'react-dnd'\nimport { HTML5Backend } from 'react-dnd-html5-backend'\nimport Axios, { AxiosRequestConfig } from 'axios'\nimport { Paths } from '../../routesPaths'\nimport { doActionToView, getGoalStates, fixInfinityNumber } from '../../game/views'\nimport { Table, Button, Modal, Form } from 'react-bootstrap'\nimport Context from './gameContext'\nimport { playCardsToAction, discardAction } from '../../game/actions'\nimport { GoalsComponent } from './Goals'\nimport { LinkContainer } from 'react-router-bootstrap'\nimport { \n  AppBar, \n  Toolbar, \n  Typography, \n  makeStyles, \n  Button as MButton, \n  IconButton, \n  Container, \n  Grid, \n  Drawer,\n  List, \n  Divider, \n  ListItem, \n  ListItemText, \n  BottomNavigation, \n  Dialog,\n  Slide, \n  DialogTitle,\n  DialogContent,\n  DialogContentText,\n  DialogActions} from '@material-ui/core'\nimport MenuIcon from '@material-ui/icons/Menu'\nimport UndoIcon from '@material-ui/icons/Undo'\nimport FeedbackIcon from '@material-ui/icons/Feedback'\nimport NavigateNextIcon from '@material-ui/icons/NavigateNext'\n\nimport './Board.css'\nimport { TransitionProps } from '@material-ui/core/transitions/transition'\nimport { genTruthTableInStringForBTrees } from '../../server/gameApp/logicResolver/plainResolver'\nimport { parsePremiseSafe } from '../../server/gameApp/game/premise'\nimport { useStyles } from '../appbar'\nimport { TruthTable } from './Truthtable'\n\n\nconst Transition = React.forwardRef(function Transition(\n  props: TransitionProps & { children?: React.ReactElement<any, any> },\n  ref: React.Ref<unknown>,\n) {\n  return <Slide direction=\"up\" ref={ref} {...props} />;\n})\n\nconst playAs: Card = \"A\"\n\ninterface Props {\n  title: string\n  description: string[]\n  initView: GameView\n  nextUrl: string\n  backUrl: string\n}\n\n// Game board\nconst LevelBoardComponent = ({\n  title,\n  description,\n  initView,\n  nextUrl,\n  backUrl\n}: Props) => {\n\n  // Actions been taken in this round\n  const [actions, setActions] = useState([] as GameAction[])\n  // Which hand card is selected at now \n  // -1 if no card is selected\n  const [handSelected, setHandSelected] = useState(-1)\n  // History of views in this round\n  const [historyViews, setHV] = useState([fixInfinityNumber(initView)])\n  // Whether to show the right hand side drawer\n  const [isShowDrawer, setShowDrawer] = useState(false)\n  const [isShownSuccessDialogue, setShownSuccessDialogue] = useState(false)\n  const [isShowTruthTable, setShowTruthTable] = useState(false)\n  const [bottomNavIndex, setBottomNavIndex] = useState(0)\n  \n  // which description to display, if descIndex = description.length, no display\n  const [descIndex, setDescIndex] = useState(description.length)\n\n  const view = historyViews[historyViews.length - 1]\n\n  const [goalStates, setGoalStates] = useState(view.goals.map(_ => false))\n\n  const classes = useStyles()\n\n  const [allVars, setAllVars] = useState<Card[]>([])\n\n\n  // Refresh from server at the very beginning\n  useEffect(() => {\n    setDescIndex(0)\n    setShownSuccessDialogue(false)\n    setHistoryViews([initView])\n  }, [initView])\n\n  // Recalculate variables  \n  useEffect(() => {\n    const cards: Set<Card> = new Set()\n    const addVars = (p: Premise) => p.filter(it => [\"A\", \"B\", \"C\", \"D\"].includes(it)).forEach(c => cards.add(c))\n    view.premises.forEach(([p, _]) => addVars(p))\n    addVars(view.handCardWithCount.map(([c, _]) => c))\n    setAllVars(Array.from(cards))\n  }, [historyViews])\n\n  const isSuccess = () => goalStates.reduce((a, b) => a && b)\n\n  const unselectHandCard = () => setHandSelected(-1)\n\n  const setHistoryViews = (newViews: GameView[]) => {\n    setHV(newViews)\n    setGoalStates(getGoalStates(newViews[newViews.length - 1]))\n  }\n\n  const pushAction = (action: GameAction) => {\n    setActions(actions.concat(action))\n  }\n\n  const popAction = () => {\n    setActions(actions.slice(0, actions.length - 1))\n  }\n\n  const pushHistoryView = (view: GameView) => {\n    setHistoryViews(historyViews.concat(view))\n  }\n\n  const popHistoryView = () => {\n    setHistoryViews(historyViews.slice(0, historyViews.length - 1))\n  }\n\n  const doAction = async (action: GameAction) => {\n    const newView = doActionToView(view, action)\n    pushAction(action)\n    pushHistoryView(newView)\n    unselectHandCard()\n  }\n\n  const undoAction = async () => {\n    if (actions.length > 0) {\n      popAction()\n      popHistoryView()\n    }\n  }\n\n  const setNextDesc = () => {\n    if (descIndex == description.length) {\n      setDescIndex(0)\n    } else {\n      setDescIndex(descIndex + 1)\n    }\n  }\n\n  const toggleDrawer = (open: boolean) => (\n    event: React.KeyboardEvent | React.MouseEvent,\n  ) => {\n    if (\n      event.type === 'keydown' &&\n      ((event as React.KeyboardEvent).key === 'Tab' ||\n        (event as React.KeyboardEvent).key === 'Shift')\n    ) {\n      return\n    }\n    setShowDrawer(open)\n  } \n\n  const submitAnswerToServer = () => {\n    const config: AxiosRequestConfig = {\n      params: {\n        isSuccess: isSuccess()\n      }\n    }\n    Axios.get(Paths.levelSubmit, config)\n      .then(res => {\n        alert(res.data.msg);\n      })\n  }\n\n  const renderSuccessDialogue =\n    <Dialog\n      open={!isShownSuccessDialogue && isSuccess()}\n      TransitionComponent={Transition}\n      keepMounted\n      onClose={() => setShownSuccessDialogue(true)}\n      aria-labelledby=\"alert-dialog-slide-title\"\n      aria-describedby=\"alert-dialog-slide-description\"\n      style={{ color: 'green' }}\n    >\n      <DialogTitle id=\"alert-dialog-slide-title\" style={{ color: 'green'}}>LEVEL PASSED!</DialogTitle>\n      <DialogContent>\n        <DialogContentText id=\"alert-dialog-slide-description\">\n          You have completed this challenge!\n        </DialogContentText>\n      </DialogContent>\n      <DialogActions>\n        <MButton onClick={() => setShownSuccessDialogue(true)} color=\"secondary\">\n          CLOSE\n        </MButton>\n        {nextUrl !== \"\" ? <LinkContainer to={nextUrl}>\n          <MButton color=\"primary\">\n            NEXT LEVEL\n          </MButton>\n        </LinkContainer> : undefined}\n      </DialogActions>\n    </Dialog>\n\n  const renderPremises = (): JSX.Element => {\n    const result: JSX.Element[] = []\n    for (let i = 0; i < 4; i++) {\n      const [premise, isLocked] = view.premises[i] ?? [[], true]\n      result.push(\n        <PremiseComponent \n          cards={premise} \n          scale={1}\n          isLocked={isLocked}\n          isProofPremise={true}\n          premiseIndex={i} \n        />\n      )\n    }\n    if (view.premises.length == 1) {\n      [result[0], result[1]] = [result[1], result[0]]\n    } else if (view.premises.length == 2) {\n      [result[1], result[2], result[0]] = [result[0], result[1], result[2]]\n    }\n    return (\n      <Table striped hover>\n        {result.map(it => <tr>{it}</tr>)}\n      </Table>\n    )\n  }\n\n  const renderHandCardArea = (): JSX.Element => {\n    return <HandCardAreaComponent\n      playerVar={playAs}\n      cards={view.handCardWithCount}\n    />\n  }\n\n  const renderGoals = (): JSX.Element => {\n    return <GoalsComponent goals={view.goals} isSuccessful={goalStates} ></GoalsComponent>\n  }\n\n  const renderDrawerContent = (): JSX.Element => {\n    const menu = <div>\n      <List>\n        <ListItem button key=\"sub\" onClick={submitAnswerToServer}>\n          <ListItemText primary=\"Submit\"/>\n        </ListItem>\n      </List>\n      <Divider/>\n      <List>\n        <LinkContainer to={backUrl}>\n          <ListItem button key=\"levelPage\" onClick={() => {}}>\n            <ListItemText primary=\"Back to Level Page\"/>\n          </ListItem>\n        </LinkContainer>\n        <LinkContainer to='/'>\n          <ListItem button key=\"menu\" onClick={() => {}}>\n            <ListItemText primary=\"Back to Main Menu\"/>\n          </ListItem>\n        </LinkContainer>\n      </List>\n    </div>\n    return menu\n  }\n\n  return(\n    <DndProvider backend={HTML5Backend}>\n      <Context.Provider value={{\n          playerVar: playAs,\n          handSelected: handSelected,\n          handCardSelected: handSelected >= 0 ? view.handCardWithCount[handSelected][0] : undefined,\n          unselectHand: unselectHandCard,\n          pickHandCardCallback: (handIndex: number) => {\n            setHandSelected(handIndex)\n          },\n          moveHandCardToPremise: (premiseId: number, inPremiseIndex: number) => {\n            doAction(playCardsToAction(playAs, handSelected, [premiseId, inPremiseIndex]))\n          },\n          discardPickedHandCard: () => {\n            doAction(discardAction(playAs, handSelected))\n          }\n      }}>\n        <AppBar position=\"static\">\n          <Toolbar style={{ backgroundColor: '#F2994A'}}>\n            <Typography variant=\"h6\" className={classes.title}>\n              {title}\n            </Typography>\n            <IconButton \n              edge=\"start\" \n              className={classes.menuButton} \n              color=\"inherit\" \n              aria-label=\"menu\"\n              onClick={toggleDrawer(true)}\n            >\n              <MenuIcon />\n            </IconButton>\n            <Drawer anchor=\"right\" open={isShowDrawer} onClose={toggleDrawer(false)}>\n              {renderDrawerContent()}\n            </Drawer>\n          </Toolbar>\n        </AppBar>\n        <Container maxWidth=\"xl\">\n          {renderPremises()}\n        </Container>\n        <Divider/>\n\n        <Container maxWidth=\"xl\" style={{ marginTop: \"20px\" }}>\n          <Grid container spacing={0}>\n            <Grid item xs={6}>\n              {renderHandCardArea()}\n            </Grid>\n            <Grid item xs={6}>\n              {renderGoals()}\n            </Grid>\n          </Grid>\n        </Container>\n        <Divider/>\n        {/* Navbar at the bottom */}\n        <BottomNavigation\n          value={bottomNavIndex}\n          showLabels\n          className={classes.root}\n          style={{\n            width: '100%',\n            position: 'sticky',\n            bottom: 0,\n          }}\n        > \n          <MButton startIcon={<UndoIcon/>} onClick={undoAction}>UNDO ONE STEP</MButton>  \n          <MButton disabled={description.length == 0}  startIcon={<FeedbackIcon/>} onClick={setNextDesc}>SHOW HINTS</MButton>  \n          <MButton startIcon={<FeedbackIcon/>} onClick={() => setShowTruthTable(true)}>SHOW TRUTH TABLE</MButton>  \n          <LinkContainer to={nextUrl}>\n            <MButton disabled={nextUrl === \"\" || !isSuccess()}  startIcon={<NavigateNextIcon/>}>NEXT LEVEL</MButton>  \n          </LinkContainer>\n        </BottomNavigation>\n        {/* Pop-up hints */}\n        <Dialog open={descIndex != description.length} onClose={() => setDescIndex(description.length)}>\n          <DialogTitle>Hint</DialogTitle>\n          <DialogContent>\n            <Form>\n              <Form.Label>{description[descIndex]}</Form.Label>\n            </Form>\n          </DialogContent>\n          <DialogActions>\n            <Button onClick={setNextDesc}>→</Button>\n          </DialogActions>\n        </Dialog>\n\n        <Dialog open={isShowTruthTable} onClose={() => setShowTruthTable(false)}>\n          <DialogTitle>Truth Table</DialogTitle>\n          <DialogContent>\n            {<TruthTable premises={view.premises.map(([p, _]) => p)}/>}\n          </DialogContent>\n        </Dialog>\n        {renderSuccessDialogue}\n      </Context.Provider>\n    </DndProvider>\n  )\n\n}\n\nexport { LevelBoardComponent }"]},"metadata":{},"sourceType":"module"}