{"ast":null,"code":"var _jsxFileName = \"/Users/johnny/IC/Computing/DRP/drp48/src/components/game/LevelBoard.tsx\";\nimport React, { useState, useEffect, useRef } from 'react';\nimport { PremiseComponent } from './Premise';\nimport { HandCardAreaComponent } from './HandCard';\nimport { DndProvider } from 'react-dnd';\nimport { HTML5Backend } from 'react-dnd-html5-backend';\nimport Axios from 'axios';\nimport { Paths } from '../../routesPaths';\nimport { doActionToView, getGoalStates, fixInfinityNumber } from '../../game/views';\nimport { Table, Button, Overlay, Tooltip, ButtonGroup } from 'react-bootstrap';\nimport Context from './gameContext';\nimport { playCardsToAction, discardAction } from '../../game/actions';\nimport { variable } from '../../server/gameApp/logicResolver/bools';\nimport { GoalsComponent } from './Goals';\nimport { useParams } from 'react-router';\nimport './Board.css';\n\nfunction initialGameView(playerVar) {\n  return {\n    playerVar: playerVar,\n    handCardWithCount: [],\n    discardPile: [],\n    premises: [],\n    deckCount: 0,\n    goals: [{\n      kind: 'prove',\n      expr: [playerVar],\n      boolTree: variable(playerVar)\n    }]\n  };\n}\n\nconst playAs = \"A\"; // Game board\n\nconst LevelBoardComponent = () => {\n  // read router parameter\n  const params = useParams();\n  const levelID = Number(params.levelID);\n  console.log(params.levelID); // Actions been taken in this round\n\n  const [actions, setActions] = useState([]); // Which hand card is selected at now \n  // -1 if no card is selected\n\n  const [handSelected, setHandSelected] = useState(-1); // History of views in this round\n\n  const [historyViews, setHV] = useState([initialGameView(\"A\")]); // Title and description for the current level\n\n  const [[title, description], setTexts] = useState([\"title\", [\"desciption\"]]); // Whether this level has a next level\n\n  const [hasNext, setHasNext] = useState(true); // which description to display, if descIndex = description.length, no display\n\n  const [descIndex, setDescIndex] = useState(0); // Ref for description button\n\n  const descRef = useRef(null);\n  const view = historyViews[historyViews.length - 1];\n  const [goalStates, setGoalStates] = useState(view.goals.map(_ => false)); // Refresh from server at the very beginning\n\n  useEffect(() => {\n    fetchInitLevelFromServer();\n  }, []);\n\n  const isSuccess = () => goalStates.reduce((a, b) => a && b);\n\n  const unselectHandCard = () => setHandSelected(-1);\n\n  const setHistoryViews = newViews => {\n    setHV(newViews);\n    setGoalStates(getGoalStates(newViews[newViews.length - 1]));\n  };\n\n  const pushAction = action => {\n    setActions(actions.concat(action));\n  };\n\n  const popAction = () => {\n    setActions(actions.slice(0, actions.length - 1));\n  };\n\n  const pushHistoryView = view => {\n    setHistoryViews(historyViews.concat(view));\n  };\n\n  const popHistoryView = () => {\n    setHistoryViews(historyViews.slice(0, historyViews.length - 1));\n  };\n\n  const doAction = action => {\n    const newView = doActionToView(view, action);\n    pushAction(action);\n    pushHistoryView(newView);\n    unselectHandCard();\n  };\n\n  const undoAction = () => {\n    if (actions.length > 0) {\n      popAction();\n      popHistoryView();\n    }\n  };\n\n  const clearHistory = () => {\n    while (actions.length > 0) {\n      undoAction();\n    }\n  };\n\n  const setNextDesc = () => {\n    if (descIndex == description.length) {\n      setDescIndex(0);\n    } else {\n      setDescIndex(descIndex + 1);\n    }\n  };\n\n  const collectAllVars = () => {\n    const set = new Set();\n\n    const collectOn = collection => {\n      collection.filter(card => [\"A\", \"B\", \"C\", \"D\"].includes(card)).forEach(v => set.add(v));\n    };\n\n    view.premises.forEach(([p, _]) => collectOn(p));\n    collectOn(view.handCardWithCount.map(([c, _]) => c));\n    collectOn(view.discardPile);\n    view.goals.forEach(goal => {\n      collectOn(goal.expr);\n    });\n    return Array.from(set).sort();\n  };\n\n  const fetchInitLevelFromServer = () => {\n    const config = {\n      params: {\n        levelID: levelID\n      }\n    };\n    Axios.get(Paths.levelRequest, config).then(res => {\n      setHistoryViews([fixInfinityNumber(res.data.view)]);\n      setTexts([res.data.title, res.data.description]);\n    });\n  };\n\n  const menuAction = () => {\n    if (actions.length > 0) {\n      fetchInitLevelFromServer();\n    }\n\n    window.location.href = '../../levelPage/' + params.sid;\n  };\n\n  const nextAction = () => {\n    const nextLevel = levelID + 1;\n    const config = {\n      params: {\n        levelID: nextLevel\n      }\n    };\n    Axios.get(Paths.levelBelongToSection, config).then(res => window.location.href = '../../level/' + res.data + '/' + nextLevel);\n  };\n\n  const submitAnswerToServer = () => {\n    const config = {\n      params: {\n        isSuccess: isSuccess()\n      }\n    };\n    Axios.get(Paths.levelSubmit, config).then(res => {\n      alert(res.data.msg);\n    });\n  };\n\n  const renderPremises = () => {\n    const result = [];\n\n    for (let i = 0; i < view.premises.length; i++) {\n      const [premise, isLocked] = view.premises[i];\n      result.push( /*#__PURE__*/React.createElement(PremiseComponent, {\n        cards: premise,\n        scale: 1,\n        isLocked: isLocked,\n        premiseIndex: i,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 192,\n          columnNumber: 9\n        }\n      }));\n    }\n\n    return /*#__PURE__*/React.createElement(Table, {\n      striped: true,\n      bordered: true,\n      hover: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 201,\n        columnNumber: 7\n      }\n    }, result.map(it => /*#__PURE__*/React.createElement(\"tr\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 202,\n        columnNumber: 27\n      }\n    }, it)));\n  };\n\n  const renderHandCardArea = () => {\n    return /*#__PURE__*/React.createElement(HandCardAreaComponent, {\n      playerVar: playAs,\n      cards: view.handCardWithCount,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 208,\n        columnNumber: 12\n      }\n    });\n  };\n\n  const renderGoals = () => {\n    return /*#__PURE__*/React.createElement(GoalsComponent, {\n      goals: view.goals,\n      isSuccessful: goalStates,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 215,\n        columnNumber: 12\n      }\n    });\n  };\n\n  const renderTitle = () => {\n    return /*#__PURE__*/React.createElement(\"h2\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 219,\n        columnNumber: 12\n      }\n    }, title);\n  };\n\n  const renderDescription = () => {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 223,\n        columnNumber: 12\n      }\n    }, description.map(it => /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 223,\n        columnNumber: 40\n      }\n    }, it)));\n  };\n\n  const renderButtonPanel = () => {\n    const buttonRef = /*#__PURE__*/React.createElement(Button, {\n      className: \"prettyButton\",\n      onClick: fetchInitLevelFromServer,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 227,\n        columnNumber: 23\n      }\n    }, \"refresh\");\n    const buttonSubmit = /*#__PURE__*/React.createElement(Button, {\n      className: \"prettyButton\",\n      onClick: submitAnswerToServer,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 228,\n        columnNumber: 26\n      }\n    }, \"submit\");\n    const buttonUndo = /*#__PURE__*/React.createElement(Button, {\n      className: \"prettyButton\",\n      onClick: undoAction,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 229,\n        columnNumber: 24\n      }\n    }, \"Undo\");\n    const buttonNext = /*#__PURE__*/React.createElement(Button, {\n      className: \"prettyButton\",\n      onClick: nextAction,\n      disabled: hasNext && isSuccess(),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 230,\n        columnNumber: 24\n      }\n    }, \"Next Level\");\n    const buttonMenu = /*#__PURE__*/React.createElement(Button, {\n      className: \"prettyButton\",\n      onClick: menuAction,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 235,\n        columnNumber: 24\n      }\n    }, \"Back to menu\");\n    const buttonDesc = /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Button, {\n      ref: descRef,\n      className: \"prettyButton\",\n      onClick: setNextDesc,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 237,\n        columnNumber: 7\n      }\n    }, description.length == 0 ? \"No Hint\" : descIndex == description.length ? \"Show Hint\" : descIndex == description.length - 1 ? \"Hide Hint\" : \"next hint\"), /*#__PURE__*/React.createElement(Overlay, {\n      target: descRef.current,\n      show: descIndex != description.length,\n      placement: \"bottom\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 243,\n        columnNumber: 7\n      }\n    }, props => /*#__PURE__*/React.createElement(Tooltip, Object.assign({\n      id: \"overlay-example\"\n    }, props, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 245,\n        columnNumber: 11\n      }\n    }), description[descIndex])));\n    return /*#__PURE__*/React.createElement(ButtonGroup, {\n      vertical: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 252,\n        columnNumber: 12\n      }\n    }, [buttonRef, buttonSubmit, buttonUndo, buttonNext, buttonMenu, buttonDesc]);\n  };\n\n  return /*#__PURE__*/React.createElement(DndProvider, {\n    backend: HTML5Backend,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 258,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Context.Provider, {\n    value: {\n      playerVar: playAs,\n      handSelected: handSelected,\n      handCardSelected: handSelected >= 0 ? view.handCardWithCount[handSelected][0] : undefined,\n      unselectHand: unselectHandCard,\n      pickHandCardCallback: handIndex => {\n        setHandSelected(handIndex);\n      },\n      moveHandCardToPremise: (premiseId, inPremiseIndex) => {\n        doAction(playCardsToAction(playAs, handSelected, [premiseId, inPremiseIndex]));\n      },\n      discardPickedHandCard: () => {\n        doAction(discardAction(playAs, handSelected));\n      }\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 259,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"status\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 274,\n      columnNumber: 9\n    }\n  }, renderTitle()), renderPremises(), /*#__PURE__*/React.createElement(Table, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 276,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"tbody\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 277,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"tr\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 278,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"td\", {\n    style: {\n      width: \"50rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 279,\n      columnNumber: 15\n    }\n  }, renderHandCardArea()), /*#__PURE__*/React.createElement(\"td\", {\n    style: {\n      width: 'auto'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 280,\n      columnNumber: 15\n    }\n  }, renderButtonPanel())))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"board-row\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 284,\n      columnNumber: 9\n    }\n  }, renderGoals())));\n};\n\nexport { LevelBoardComponent };","map":{"version":3,"sources":["/Users/johnny/IC/Computing/DRP/drp48/src/components/game/LevelBoard.tsx"],"names":["React","useState","useEffect","useRef","PremiseComponent","HandCardAreaComponent","DndProvider","HTML5Backend","Axios","Paths","doActionToView","getGoalStates","fixInfinityNumber","Table","Button","Overlay","Tooltip","ButtonGroup","Context","playCardsToAction","discardAction","variable","GoalsComponent","useParams","initialGameView","playerVar","handCardWithCount","discardPile","premises","deckCount","goals","kind","expr","boolTree","playAs","LevelBoardComponent","params","levelID","Number","console","log","actions","setActions","handSelected","setHandSelected","historyViews","setHV","title","description","setTexts","hasNext","setHasNext","descIndex","setDescIndex","descRef","view","length","goalStates","setGoalStates","map","_","fetchInitLevelFromServer","isSuccess","reduce","a","b","unselectHandCard","setHistoryViews","newViews","pushAction","action","concat","popAction","slice","pushHistoryView","popHistoryView","doAction","newView","undoAction","clearHistory","setNextDesc","collectAllVars","set","Set","collectOn","collection","filter","card","includes","forEach","v","add","p","c","goal","Array","from","sort","config","get","levelRequest","then","res","data","menuAction","window","location","href","sid","nextAction","nextLevel","levelBelongToSection","submitAnswerToServer","levelSubmit","alert","msg","renderPremises","result","i","premise","isLocked","push","it","renderHandCardArea","renderGoals","renderTitle","renderDescription","renderButtonPanel","buttonRef","buttonSubmit","buttonUndo","buttonNext","buttonMenu","buttonDesc","current","props","handCardSelected","undefined","unselectHand","pickHandCardCallback","handIndex","moveHandCardToPremise","premiseId","inPremiseIndex","discardPickedHandCard","width"],"mappings":";AAAA,OAAOA,KAAP,IAAgBC,QAAhB,EAA0BC,SAA1B,EAAqCC,MAArC,QAAmD,OAAnD;AACA,SAASC,gBAAT,QAAiC,WAAjC;AACA,SAASC,qBAAT,QAAsC,YAAtC;AAEA,SAASC,WAAT,QAA4B,WAA5B;AACA,SAASC,YAAT,QAA6B,yBAA7B;AAEA,OAAOC,KAAP,MAA0C,OAA1C;AAEA,SAASC,KAAT,QAAoC,mBAApC;AACA,SAASC,cAAT,EAAyCC,aAAzC,EAAwDC,iBAAxD,QAAiF,kBAAjF;AACA,SAASC,KAAT,EAAgBC,MAAhB,EAAwBC,OAAxB,EAAiCC,OAAjC,EAA0CC,WAA1C,QAA6D,iBAA7D;AACA,OAAOC,OAAP,MAAoB,eAApB;AACA,SAASC,iBAAT,EAA4BC,aAA5B,QAAiD,oBAAjD;AACA,SAASC,QAAT,QAAmC,0CAAnC;AACA,SAASC,cAAT,QAA+B,SAA/B;AACA,SAASC,SAAT,QAA0B,cAA1B;AAEA,OAAO,aAAP;;AAOA,SAASC,eAAT,CAAyBC,SAAzB,EAAsD;AACpD,SAAO;AACLA,IAAAA,SAAS,EAAEA,SADN;AAELC,IAAAA,iBAAiB,EAAE,EAFd;AAGLC,IAAAA,WAAW,EAAE,EAHR;AAILC,IAAAA,QAAQ,EAAE,EAJL;AAKLC,IAAAA,SAAS,EAAE,CALN;AAMLC,IAAAA,KAAK,EAAE,CAAC;AAAEC,MAAAA,IAAI,EAAE,OAAR;AAAiBC,MAAAA,IAAI,EAAE,CAACP,SAAD,CAAvB;AAA4CQ,MAAAA,QAAQ,EAAEZ,QAAQ,CAACI,SAAD;AAA9D,KAAD;AANF,GAAP;AAQD;;AAED,MAAMS,MAAY,GAAG,GAArB,C,CAEA;;AACA,MAAMC,mBAAmB,GAAG,MAAM;AAChC;AACA,QAAMC,MAAM,GAAGb,SAAS,EAAxB;AACA,QAAMc,OAAO,GAAGC,MAAM,CAACF,MAAM,CAACC,OAAR,CAAtB;AAEAE,EAAAA,OAAO,CAACC,GAAR,CAAYJ,MAAM,CAACC,OAAnB,EALgC,CAQhC;;AACA,QAAM,CAACI,OAAD,EAAUC,UAAV,IAAwBzC,QAAQ,CAAC,EAAD,CAAtC,CATgC,CAUhC;AACA;;AACA,QAAM,CAAC0C,YAAD,EAAeC,eAAf,IAAkC3C,QAAQ,CAAC,CAAC,CAAF,CAAhD,CAZgC,CAahC;;AACA,QAAM,CAAC4C,YAAD,EAAeC,KAAf,IAAwB7C,QAAQ,CAAC,CAACuB,eAAe,CAAC,GAAD,CAAhB,CAAD,CAAtC,CAdgC,CAehC;;AACA,QAAM,CAAC,CAACuB,KAAD,EAAQC,WAAR,CAAD,EAAuBC,QAAvB,IAAmChD,QAAQ,CAAC,CAAC,OAAD,EAAU,CAAC,YAAD,CAAV,CAAD,CAAjD,CAhBgC,CAiBhC;;AACA,QAAM,CAACiD,OAAD,EAAUC,UAAV,IAAwBlD,QAAQ,CAAC,IAAD,CAAtC,CAlBgC,CAmBhC;;AACA,QAAM,CAACmD,SAAD,EAAYC,YAAZ,IAA4BpD,QAAQ,CAAC,CAAD,CAA1C,CApBgC,CAqBhC;;AACA,QAAMqD,OAAO,GAAGnD,MAAM,CAAC,IAAD,CAAtB;AAEA,QAAMoD,IAAI,GAAGV,YAAY,CAACA,YAAY,CAACW,MAAb,GAAsB,CAAvB,CAAzB;AAEA,QAAM,CAACC,UAAD,EAAaC,aAAb,IAA8BzD,QAAQ,CAACsD,IAAI,CAACzB,KAAL,CAAW6B,GAAX,CAAeC,CAAC,IAAI,KAApB,CAAD,CAA5C,CA1BgC,CA6BhC;;AACA1D,EAAAA,SAAS,CAAC,MAAM;AACd2D,IAAAA,wBAAwB;AACzB,GAFQ,EAEN,EAFM,CAAT;;AAIA,QAAMC,SAAS,GAAG,MAAML,UAAU,CAACM,MAAX,CAAkB,CAACC,CAAD,EAAIC,CAAJ,KAAUD,CAAC,IAAIC,CAAjC,CAAxB;;AAEA,QAAMC,gBAAgB,GAAG,MAAMtB,eAAe,CAAC,CAAC,CAAF,CAA9C;;AAEA,QAAMuB,eAAe,GAAIC,QAAD,IAA0B;AAChDtB,IAAAA,KAAK,CAACsB,QAAD,CAAL;AACAV,IAAAA,aAAa,CAAC/C,aAAa,CAACyD,QAAQ,CAACA,QAAQ,CAACZ,MAAT,GAAkB,CAAnB,CAAT,CAAd,CAAb;AACD,GAHD;;AAKA,QAAMa,UAAU,GAAIC,MAAD,IAAwB;AACzC5B,IAAAA,UAAU,CAACD,OAAO,CAAC8B,MAAR,CAAeD,MAAf,CAAD,CAAV;AACD,GAFD;;AAIA,QAAME,SAAS,GAAG,MAAM;AACtB9B,IAAAA,UAAU,CAACD,OAAO,CAACgC,KAAR,CAAc,CAAd,EAAiBhC,OAAO,CAACe,MAAR,GAAiB,CAAlC,CAAD,CAAV;AACD,GAFD;;AAIA,QAAMkB,eAAe,GAAInB,IAAD,IAAoB;AAC1CY,IAAAA,eAAe,CAACtB,YAAY,CAAC0B,MAAb,CAAoBhB,IAApB,CAAD,CAAf;AACD,GAFD;;AAIA,QAAMoB,cAAc,GAAG,MAAM;AAC3BR,IAAAA,eAAe,CAACtB,YAAY,CAAC4B,KAAb,CAAmB,CAAnB,EAAsB5B,YAAY,CAACW,MAAb,GAAsB,CAA5C,CAAD,CAAf;AACD,GAFD;;AAIA,QAAMoB,QAAQ,GAAIN,MAAD,IAAwB;AACvC,UAAMO,OAAO,GAAGnE,cAAc,CAAC6C,IAAD,EAAOe,MAAP,CAA9B;AACAD,IAAAA,UAAU,CAACC,MAAD,CAAV;AACAI,IAAAA,eAAe,CAACG,OAAD,CAAf;AACAX,IAAAA,gBAAgB;AACjB,GALD;;AAOA,QAAMY,UAAU,GAAG,MAAM;AACvB,QAAIrC,OAAO,CAACe,MAAR,GAAiB,CAArB,EAAwB;AACtBgB,MAAAA,SAAS;AACTG,MAAAA,cAAc;AACf;AACF,GALD;;AAOA,QAAMI,YAAY,GAAG,MAAM;AACzB,WAAOtC,OAAO,CAACe,MAAR,GAAiB,CAAxB,EAA2B;AACzBsB,MAAAA,UAAU;AACX;AACF,GAJD;;AAMA,QAAME,WAAW,GAAG,MAAM;AACxB,QAAI5B,SAAS,IAAIJ,WAAW,CAACQ,MAA7B,EAAqC;AACnCH,MAAAA,YAAY,CAAC,CAAD,CAAZ;AACD,KAFD,MAEO;AACLA,MAAAA,YAAY,CAACD,SAAS,GAAG,CAAb,CAAZ;AACD;AACF,GAND;;AAQA,QAAM6B,cAAc,GAAG,MAAc;AACnC,UAAMC,GAAG,GAAG,IAAIC,GAAJ,EAAZ;;AACA,UAAMC,SAAS,GAAIC,UAAD,IAAwB;AACxCA,MAAAA,UAAU,CACPC,MADH,CACUC,IAAI,IAAK,CAAC,GAAD,EAAM,GAAN,EAAW,GAAX,EAAgB,GAAhB,CAAD,CAAuBC,QAAvB,CAAgCD,IAAhC,CADlB,EAEGE,OAFH,CAEWC,CAAC,IAAIR,GAAG,CAACS,GAAJ,CAAQD,CAAR,CAFhB;AAGD,KAJD;;AAKAnC,IAAAA,IAAI,CAAC3B,QAAL,CAAc6D,OAAd,CAAsB,CAAC,CAACG,CAAD,EAAIhC,CAAJ,CAAD,KAAYwB,SAAS,CAACQ,CAAD,CAA3C;AACAR,IAAAA,SAAS,CAAC7B,IAAI,CAAC7B,iBAAL,CAAuBiC,GAAvB,CAA2B,CAAC,CAACkC,CAAD,EAAIjC,CAAJ,CAAD,KAAYiC,CAAvC,CAAD,CAAT;AACAT,IAAAA,SAAS,CAAC7B,IAAI,CAAC5B,WAAN,CAAT;AACA4B,IAAAA,IAAI,CAACzB,KAAL,CAAW2D,OAAX,CAAmBK,IAAI,IAAI;AACzBV,MAAAA,SAAS,CAACU,IAAI,CAAC9D,IAAN,CAAT;AACD,KAFD;AAIA,WAAO+D,KAAK,CAACC,IAAN,CAAWd,GAAX,EAAgBe,IAAhB,EAAP;AACD,GAfD;;AAiBA,QAAMpC,wBAAwB,GAAG,MAAM;AACrC,UAAMqC,MAA0B,GAAG;AACjC9D,MAAAA,MAAM,EAAE;AACNC,QAAAA,OAAO,EAAEA;AADH;AADyB,KAAnC;AAKA7B,IAAAA,KAAK,CAAC2F,GAAN,CAAyB1F,KAAK,CAAC2F,YAA/B,EAA6CF,MAA7C,EACGG,IADH,CACQC,GAAG,IAAI;AACXnC,MAAAA,eAAe,CAAC,CAACvD,iBAAiB,CAAC0F,GAAG,CAACC,IAAJ,CAAShD,IAAV,CAAlB,CAAD,CAAf;AACAN,MAAAA,QAAQ,CAAC,CAACqD,GAAG,CAACC,IAAJ,CAASxD,KAAV,EAAiBuD,GAAG,CAACC,IAAJ,CAASvD,WAA1B,CAAD,CAAR;AACD,KAJH;AAKD,GAXD;;AAaA,QAAMwD,UAAU,GAAG,MAAM;AACvB,QAAI/D,OAAO,CAACe,MAAR,GAAiB,CAArB,EAAwB;AACtBK,MAAAA,wBAAwB;AACzB;;AACD4C,IAAAA,MAAM,CAACC,QAAP,CAAgBC,IAAhB,GAAqB,qBAAqBvE,MAAM,CAACwE,GAAjD;AACD,GALD;;AAOA,QAAMC,UAAU,GAAG,MAAM;AACvB,UAAMC,SAAS,GAAGzE,OAAO,GAAG,CAA5B;AACA,UAAM6D,MAA0B,GAAG;AACjC9D,MAAAA,MAAM,EAAE;AACNC,QAAAA,OAAO,EAAEyE;AADH;AADyB,KAAnC;AAKAtG,IAAAA,KAAK,CAAC2F,GAAN,CAAkB1F,KAAK,CAACsG,oBAAxB,EAA8Cb,MAA9C,EACGG,IADH,CACQC,GAAG,IAAIG,MAAM,CAACC,QAAP,CAAgBC,IAAhB,GAAuB,iBAAiBL,GAAG,CAACC,IAArB,GAA4B,GAA5B,GAAkCO,SADxE;AAED,GATD;;AAWA,QAAME,oBAAoB,GAAG,MAAM;AACjC,UAAMd,MAA0B,GAAG;AACjC9D,MAAAA,MAAM,EAAE;AACN0B,QAAAA,SAAS,EAAEA,SAAS;AADd;AADyB,KAAnC;AAKAtD,IAAAA,KAAK,CAAC2F,GAAN,CAAU1F,KAAK,CAACwG,WAAhB,EAA6Bf,MAA7B,EACGG,IADH,CACQC,GAAG,IAAI;AACXY,MAAAA,KAAK,CAACZ,GAAG,CAACC,IAAJ,CAASY,GAAV,CAAL;AACD,KAHH;AAID,GAVD;;AAYA,QAAMC,cAAc,GAAG,MAAmB;AACxC,UAAMC,MAAqB,GAAG,EAA9B;;AACA,SAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG/D,IAAI,CAAC3B,QAAL,CAAc4B,MAAlC,EAA0C8D,CAAC,EAA3C,EAA+C;AAC7C,YAAM,CAACC,OAAD,EAAUC,QAAV,IAAsBjE,IAAI,CAAC3B,QAAL,CAAc0F,CAAd,CAA5B;AACAD,MAAAA,MAAM,CAACI,IAAP,eACE,oBAAC,gBAAD;AACE,QAAA,KAAK,EAAEF,OADT;AAEE,QAAA,KAAK,EAAE,CAFT;AAGE,QAAA,QAAQ,EAAEC,QAHZ;AAIE,QAAA,YAAY,EAAEF,CAJhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADF;AAQD;;AACD,wBACE,oBAAC,KAAD;AAAO,MAAA,OAAO,MAAd;AAAe,MAAA,QAAQ,MAAvB;AAAwB,MAAA,KAAK,MAA7B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACGD,MAAM,CAAC1D,GAAP,CAAW+D,EAAE,iBAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAKA,EAAL,CAAjB,CADH,CADF;AAKD,GAlBD;;AAoBA,QAAMC,kBAAkB,GAAG,MAAmB;AAC5C,wBAAO,oBAAC,qBAAD;AACL,MAAA,SAAS,EAAEzF,MADN;AAEL,MAAA,KAAK,EAAEqB,IAAI,CAAC7B,iBAFP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAAP;AAID,GALD;;AAOA,QAAMkG,WAAW,GAAG,MAAmB;AACrC,wBAAO,oBAAC,cAAD;AAAgB,MAAA,KAAK,EAAErE,IAAI,CAACzB,KAA5B;AAAmC,MAAA,YAAY,EAAE2B,UAAjD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAAP;AACD,GAFD;;AAIA,QAAMoE,WAAW,GAAG,MAAM;AACxB,wBAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAK9E,KAAL,CAAP;AACD,GAFD;;AAIA,QAAM+E,iBAAiB,GAAG,MAAM;AAC9B,wBAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAM9E,WAAW,CAACW,GAAZ,CAAgB+D,EAAE,iBAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAIA,EAAJ,CAAtB,CAAN,CAAP;AACD,GAFD;;AAIA,QAAMK,iBAAiB,GAAG,MAAmB;AAC3C,UAAMC,SAAS,gBAAG,oBAAC,MAAD;AAAQ,MAAA,SAAS,EAAC,cAAlB;AAAiC,MAAA,OAAO,EAAEnE,wBAA1C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAAlB;AACA,UAAMoE,YAAY,gBAAG,oBAAC,MAAD;AAAQ,MAAA,SAAS,EAAC,cAAlB;AAAiC,MAAA,OAAO,EAAEjB,oBAA1C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBAArB;AACA,UAAMkB,UAAU,gBAAG,oBAAC,MAAD;AAAQ,MAAA,SAAS,EAAC,cAAlB;AAAiC,MAAA,OAAO,EAAEpD,UAA1C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAAnB;AACA,UAAMqD,UAAU,gBAAG,oBAAC,MAAD;AACjB,MAAA,SAAS,EAAC,cADO;AAEjB,MAAA,OAAO,EAAEtB,UAFQ;AAGjB,MAAA,QAAQ,EAAE3D,OAAO,IAAIY,SAAS,EAHb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAAnB;AAKA,UAAMsE,UAAU,gBAAG,oBAAC,MAAD;AAAQ,MAAA,SAAS,EAAC,cAAlB;AAAiC,MAAA,OAAO,EAAE5B,UAA1C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAAnB;AACA,UAAM6B,UAAU,gBAAG,uDACjB,oBAAC,MAAD;AAAQ,MAAA,GAAG,EAAE/E,OAAb;AAAsB,MAAA,SAAS,EAAC,cAAhC;AAA+C,MAAA,OAAO,EAAE0B,WAAxD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACEhC,WAAW,CAACQ,MAAZ,IAAsB,CAAtB,GAA0B,SAA1B,GACAJ,SAAS,IAAIJ,WAAW,CAACQ,MAAzB,GAAkC,WAAlC,GACAJ,SAAS,IAAIJ,WAAW,CAACQ,MAAZ,GAAqB,CAAlC,GAAsC,WAAtC,GACA,WAJF,CADiB,eAOjB,oBAAC,OAAD;AAAS,MAAA,MAAM,EAAEF,OAAO,CAACgF,OAAzB;AAAkC,MAAA,IAAI,EAAElF,SAAS,IAAIJ,WAAW,CAACQ,MAAjE;AAAyE,MAAA,SAAS,EAAC,QAAnF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACI+E,KAAD,iBACC,oBAAC,OAAD;AAAS,MAAA,EAAE,EAAC;AAAZ,OAAkCA,KAAlC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QACGvF,WAAW,CAACI,SAAD,CADd,CAFJ,CAPiB,CAAnB;AAgBA,wBAAO,oBAAC,WAAD;AAAa,MAAA,QAAQ,MAArB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACL,CAAC4E,SAAD,EAAYC,YAAZ,EAA0BC,UAA1B,EAAsCC,UAAtC,EAAkDC,UAAlD,EAA8DC,UAA9D,CADK,CAAP;AAGD,GA7BD;;AA+BA,sBACE,oBAAC,WAAD;AAAa,IAAA,OAAO,EAAE9H,YAAtB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE,oBAAC,OAAD,CAAS,QAAT;AAAkB,IAAA,KAAK,EAAE;AACrBkB,MAAAA,SAAS,EAAES,MADU;AAErBS,MAAAA,YAAY,EAAEA,YAFO;AAGrB6F,MAAAA,gBAAgB,EAAE7F,YAAY,IAAI,CAAhB,GAAoBY,IAAI,CAAC7B,iBAAL,CAAuBiB,YAAvB,EAAqC,CAArC,CAApB,GAA8D8F,SAH3D;AAIrBC,MAAAA,YAAY,EAAExE,gBAJO;AAKrByE,MAAAA,oBAAoB,EAAGC,SAAD,IAAuB;AAC3ChG,QAAAA,eAAe,CAACgG,SAAD,CAAf;AACD,OAPoB;AAQrBC,MAAAA,qBAAqB,EAAE,CAACC,SAAD,EAAoBC,cAApB,KAA+C;AACpEnE,QAAAA,QAAQ,CAACzD,iBAAiB,CAACe,MAAD,EAASS,YAAT,EAAuB,CAACmG,SAAD,EAAYC,cAAZ,CAAvB,CAAlB,CAAR;AACD,OAVoB;AAWrBC,MAAAA,qBAAqB,EAAE,MAAM;AAC3BpE,QAAAA,QAAQ,CAACxD,aAAa,CAACc,MAAD,EAASS,YAAT,CAAd,CAAR;AACD;AAboB,KAAzB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAeE;AAAK,IAAA,SAAS,EAAC,QAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAyBkF,WAAW,EAApC,CAfF,EAgBGT,cAAc,EAhBjB,eAiBE,oBAAC,KAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE;AAAI,IAAA,KAAK,EAAE;AAAE6B,MAAAA,KAAK,EAAE;AAAT,KAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAA+BtB,kBAAkB,EAAjD,CADF,eAEE;AAAI,IAAA,KAAK,EAAE;AAAEsB,MAAAA,KAAK,EAAE;AAAT,KAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAA8BlB,iBAAiB,EAA/C,CAFF,CADF,CADF,CAjBF,eAyBE;AAAK,IAAA,SAAS,EAAC,WAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACGH,WAAW,EADd,CAzBF,CADF,CADF;AAkCD,CA3PD;;AA6PA,SAASzF,mBAAT","sourcesContent":["import React, { useState, useEffect, useRef } from 'react'\nimport { PremiseComponent } from './Premise'\nimport { HandCardAreaComponent } from './HandCard'\nimport { Premise, GameView, GameAction, Card, TruthTableInString, LevelResponse } from '../../types'\nimport { DndProvider } from 'react-dnd'\nimport { HTML5Backend } from 'react-dnd-html5-backend'\nimport { DiscardArea } from './DiscardArea'\nimport Axios, { AxiosRequestConfig } from 'axios'\nimport SocketIOClient from 'socket.io-client'\nimport { Paths, SocketEvents } from '../../routesPaths'\nimport { doActionToView, playHandCardTo, getGoalStates, fixInfinityNumber } from '../../game/views'\nimport { Table, Button, Overlay, Tooltip, ButtonGroup } from 'react-bootstrap'\nimport Context from './gameContext'\nimport { playCardsToAction, discardAction } from '../../game/actions'\nimport { variable, BoolTree } from '../../server/gameApp/logicResolver/bools'\nimport { GoalsComponent } from './Goals'\nimport { useParams } from 'react-router'\n\nimport './Board.css'\n\ninterface LevelBoardParams {\n  sid: string\n  levelID: string\n}\n\nfunction initialGameView(playerVar: string): GameView {\n  return { \n    playerVar: playerVar,\n    handCardWithCount: [],\n    discardPile: [],\n    premises: [],\n    deckCount: 0,\n    goals: [{ kind: 'prove', expr: [playerVar as Card], boolTree: variable(playerVar) }]\n  }\n}\n\nconst playAs: Card = \"A\"\n\n// Game board\nconst LevelBoardComponent = () => {\n  // read router parameter\n  const params = useParams<LevelBoardParams>()\n  const levelID = Number(params.levelID)\n\n  console.log(params.levelID);\n  \n\n  // Actions been taken in this round\n  const [actions, setActions] = useState([] as GameAction[])\n  // Which hand card is selected at now \n  // -1 if no card is selected\n  const [handSelected, setHandSelected] = useState(-1)\n  // History of views in this round\n  const [historyViews, setHV] = useState([initialGameView(\"A\")] as GameView[])\n  // Title and description for the current level\n  const [[title, description], setTexts] = useState([\"title\", [\"desciption\"]])\n  // Whether this level has a next level\n  const [hasNext, setHasNext] = useState(true)\n  // which description to display, if descIndex = description.length, no display\n  const [descIndex, setDescIndex] = useState(0)\n  // Ref for description button\n  const descRef = useRef(null)\n\n  const view = historyViews[historyViews.length - 1]\n\n  const [goalStates, setGoalStates] = useState(view.goals.map(_ => false))\n\n\n  // Refresh from server at the very beginning\n  useEffect(() => {\n    fetchInitLevelFromServer()\n  }, [])\n\n  const isSuccess = () => goalStates.reduce((a, b) => a && b)\n\n  const unselectHandCard = () => setHandSelected(-1)\n\n  const setHistoryViews = (newViews: GameView[]) => {\n    setHV(newViews)\n    setGoalStates(getGoalStates(newViews[newViews.length - 1]))\n  }\n\n  const pushAction = (action: GameAction) => {\n    setActions(actions.concat(action))\n  }\n\n  const popAction = () => {\n    setActions(actions.slice(0, actions.length - 1))\n  }\n\n  const pushHistoryView = (view: GameView) => {\n    setHistoryViews(historyViews.concat(view))\n  }\n\n  const popHistoryView = () => {\n    setHistoryViews(historyViews.slice(0, historyViews.length - 1))\n  }\n\n  const doAction = (action: GameAction) => {\n    const newView = doActionToView(view, action)\n    pushAction(action)\n    pushHistoryView(newView)\n    unselectHandCard()\n  }\n\n  const undoAction = () => {\n    if (actions.length > 0) {\n      popAction()\n      popHistoryView()\n    }\n  }\n\n  const clearHistory = () => {\n    while (actions.length > 0) {\n      undoAction()\n    }\n  }\n\n  const setNextDesc = () => {\n    if (descIndex == description.length) {\n      setDescIndex(0)\n    } else {\n      setDescIndex(descIndex + 1)\n    }\n  }\n\n  const collectAllVars = (): Card[] => {\n    const set = new Set<Card>()\n    const collectOn = (collection: Card[]) => {\n      collection\n        .filter(card => ([\"A\", \"B\", \"C\", \"D\"]).includes(card))\n        .forEach(v => set.add(v))\n    }\n    view.premises.forEach(([p, _]) => collectOn(p))\n    collectOn(view.handCardWithCount.map(([c, _]) => c))\n    collectOn(view.discardPile)\n    view.goals.forEach(goal => {\n      collectOn(goal.expr)\n    })\n\n    return Array.from(set).sort()\n  }\n\n  const fetchInitLevelFromServer = () => {\n    const config: AxiosRequestConfig = {\n      params: {\n        levelID: levelID,\n      }\n    }\n    Axios.get<LevelResponse>(Paths.levelRequest, config)\n      .then(res => {\n        setHistoryViews([fixInfinityNumber(res.data.view)])\n        setTexts([res.data.title, res.data.description])\n      })\n  }\n\n  const menuAction = () => {\n    if (actions.length > 0) {\n      fetchInitLevelFromServer()\n    }\n    window.location.href='../../levelPage/' + params.sid\n  }\n\n  const nextAction = () => {\n    const nextLevel = levelID + 1\n    const config: AxiosRequestConfig = {\n      params: {\n        levelID: nextLevel,\n      }\n    }\n    Axios.get<number>(Paths.levelBelongToSection, config)\n      .then(res => window.location.href = '../../level/' + res.data + '/' + nextLevel)\n  }\n\n  const submitAnswerToServer = () => {\n    const config: AxiosRequestConfig = {\n      params: {\n        isSuccess: isSuccess()\n      }\n    }\n    Axios.get(Paths.levelSubmit, config)\n      .then(res => {\n        alert(res.data.msg);\n      })\n  }\n\n  const renderPremises = (): JSX.Element => {\n    const result: JSX.Element[] = []\n    for (let i = 0; i < view.premises.length; i++) {\n      const [premise, isLocked] = view.premises[i]\n      result.push(\n        <PremiseComponent \n          cards={premise} \n          scale={1}\n          isLocked={isLocked}\n          premiseIndex={i} \n        />\n      )\n    }\n    return (\n      <Table striped bordered hover>\n        {result.map(it => <tr>{it}</tr>)}\n      </Table>\n    )\n  }\n\n  const renderHandCardArea = (): JSX.Element => {\n    return <HandCardAreaComponent\n      playerVar={playAs}\n      cards={view.handCardWithCount}\n    />\n  }\n\n  const renderGoals = (): JSX.Element => {\n    return <GoalsComponent goals={view.goals} isSuccessful={goalStates} ></GoalsComponent>\n  }\n\n  const renderTitle = () => {\n    return <h2>{title}</h2>\n  }\n\n  const renderDescription = () => {\n    return <div>{description.map(it => <p>{it}</p>)}</div> \n  }\n\n  const renderButtonPanel = (): JSX.Element => {\n    const buttonRef = <Button className=\"prettyButton\" onClick={fetchInitLevelFromServer}>refresh</Button>\n    const buttonSubmit = <Button className=\"prettyButton\" onClick={submitAnswerToServer}>submit</Button>\n    const buttonUndo = <Button className=\"prettyButton\" onClick={undoAction}>Undo</Button>\n    const buttonNext = <Button \n      className=\"prettyButton\"\n      onClick={nextAction}\n      disabled={hasNext && isSuccess()}\n    >Next Level</Button>\n    const buttonMenu = <Button className=\"prettyButton\" onClick={menuAction}>Back to menu</Button>\n    const buttonDesc = <>\n      <Button ref={descRef} className=\"prettyButton\" onClick={setNextDesc}>{\n        description.length == 0 ? \"No Hint\" :\n        descIndex == description.length ? \"Show Hint\" : \n        descIndex == description.length - 1 ? \"Hide Hint\" :\n        \"next hint\"\n      }</Button>\n      <Overlay target={descRef.current} show={descIndex != description.length} placement=\"bottom\">\n        {(props) => (\n          <Tooltip id=\"overlay-example\" {...props}>\n            {description[descIndex]}\n          </Tooltip>\n        )}\n      </Overlay>\n    </>\n\n    return <ButtonGroup vertical>{\n      [buttonRef, buttonSubmit, buttonUndo, buttonNext, buttonMenu, buttonDesc]\n    }</ButtonGroup>\n  }\n\n  return(\n    <DndProvider backend={HTML5Backend}>\n      <Context.Provider value={{\n          playerVar: playAs,\n          handSelected: handSelected,\n          handCardSelected: handSelected >= 0 ? view.handCardWithCount[handSelected][0] : undefined,\n          unselectHand: unselectHandCard,\n          pickHandCardCallback: (handIndex: number) => {\n            setHandSelected(handIndex)\n          },\n          moveHandCardToPremise: (premiseId: number, inPremiseIndex: number) => {\n            doAction(playCardsToAction(playAs, handSelected, [premiseId, inPremiseIndex]))\n          },\n          discardPickedHandCard: () => {\n            doAction(discardAction(playAs, handSelected))\n          }\n      }}>\n        <div className=\"status\">{renderTitle()}</div>\n        {renderPremises()}\n        <Table >\n          <tbody>\n            <tr>\n              <td style={{ width: \"50rem\"}}>{renderHandCardArea()}</td>\n              <td style={{ width: 'auto'}}>{renderButtonPanel()}</td>\n            </tr>\n          </tbody>\n        </Table>\n        <div className=\"board-row\">\n          {renderGoals()}\n        </div>\n      </Context.Provider>\n    </DndProvider>\n  )\n\n}\n\nexport { LevelBoardComponent }"]},"metadata":{},"sourceType":"module"}